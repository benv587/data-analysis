
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../img/logo.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.6">
    
    
      
        <title>8 数据分组 - 数据处理与统计分析 V3.0</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cd566b2a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#8" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href=".." title="数据处理与统计分析 V3.0" class="md-header__button md-logo" aria-label="数据处理与统计分析 V3.0" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            数据处理与统计分析 V3.0
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              8 数据分组
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
    <img src="../assets/images/logo.svg" height="45px" alt="logo">

  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="数据处理与统计分析 V3.0" class="md-nav__button md-logo" aria-label="数据处理与统计分析 V3.0" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    数据处理与统计分析 V3.0
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          第一章 Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第一章 Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          第一章 Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01_Linux%E8%AE%B2%E4%B9%89/01_Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.html" class="md-nav__link">
        1 Linux操作系统
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01_Linux%E8%AE%B2%E4%B9%89/02_Linux%E7%B3%BB%E7%BB%9F%E9%AB%98%E7%BA%A7.html" class="md-nav__link">
        2 Linux系统高级
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          第二章 MySQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第二章 MySQL" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          第二章 MySQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02_MySQL%E8%AE%B2%E4%B9%89/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%801.html" class="md-nav__link">
        1 MySQL数据库基础I
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02_MySQL%E8%AE%B2%E4%B9%89/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%802.html" class="md-nav__link">
        2 MySQL数据库基础II
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02_MySQL%E8%AE%B2%E4%B9%89/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7.html" class="md-nav__link">
        3 MySQL高级
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          第三章 环境搭建
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第三章 环境搭建" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          第三章 环境搭建
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../03_%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/01_%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" class="md-nav__link">
        1 环境搭建及使用
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          第四章 NumPy
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第四章 NumPy" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          第四章 NumPy
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04_NumPy%E8%AE%B2%E4%B9%89/01_NumPy%E8%AE%B2%E4%B9%89.html" class="md-nav__link">
        1 NumPy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04_NumPy%E8%AE%B2%E4%B9%89/02_%E5%B8%B8%E7%94%A8%E6%A6%82%E5%BF%B5.html" class="md-nav__link">
        2 常用概念
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          第五章 Pandas
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第五章 Pandas" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          第五章 Pandas
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="01_Python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E7%AE%80%E4%BB%8B.html" class="md-nav__link">
        1 Python 数据分析处理简介
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="02_Pandas_%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html" class="md-nav__link">
        2 Pandas 数据结构
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="03_Pandas_DataFrame%E5%85%A5%E9%97%A8.html" class="md-nav__link">
        3 Pandas DataFrame 入门
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="04_Pandas%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%85%A5%E9%97%A8.html" class="md-nav__link">
        4 Pandas 数据分析入门
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="05_%E6%95%B0%E6%8D%AE%E7%BB%84%E5%90%88.html" class="md-nav__link">
        5 数据组合
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="06_%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97.html" class="md-nav__link">
        6 数据清洗
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="07_apply%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0.html" class="md-nav__link">
        7 apply 自定义函数
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          8 数据分组
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="08_%E6%95%B0%E6%8D%AE%E5%88%86%E7%BB%84.html" class="md-nav__link md-nav__link--active">
        8 数据分组
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    学习目标
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1 聚合
  </a>
  
    <nav class="md-nav" aria-label="1 聚合">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1 单变量分组聚合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-pandas" class="md-nav__link">
    1.2 Pandas内置的聚合方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3 聚合函数
  </a>
  
    <nav class="md-nav" aria-label="1.3 聚合函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    自定义函数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    1.4 同时传入多个函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-aggaggregate" class="md-nav__link">
    1.5 向agg/aggregate中传入字典
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2 转换
  </a>
  
    <nav class="md-nav" aria-label="2 转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-transform" class="md-nav__link">
    2.1 transform分组填充缺失值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-transformz" class="md-nav__link">
    2.2 使用transform分组计算z分数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3 过滤
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-dataframegroupby" class="md-nav__link">
    4 DataFrameGroupBy对象
  </a>
  
    <nav class="md-nav" aria-label="4 DataFrameGroupBy对象">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1 分组
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    4.2 遍历分组
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    4.3 多个分组
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    小结
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="09_%E6%95%B0%E6%8D%AE%E9%80%8F%E8%A7%86%E8%A1%A8.html" class="md-nav__link">
        9 数据透视表
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="10_datetime%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" class="md-nav__link">
        10 datetime 数据类型
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          第六章 数据分析绘图
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第六章 数据分析绘图" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          第六章 数据分析绘图
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06_%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/01_%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%BB%8B%E7%BB%8D.html" class="md-nav__link">
        1 Python数据可视化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06_%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/02_Matplotlib%E7%BB%98%E5%9B%BE.html" class="md-nav__link">
        2 Matplotlib绘图
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06_%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/03_Pandas%E7%BB%98%E5%9B%BE.html" class="md-nav__link">
        3 Pandas绘图
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06_%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/04_Seaborn%E7%BB%98%E5%9B%BE.html" class="md-nav__link">
        4 Seaborn 可视化
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          第七章 综合案例
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第七章 综合案例" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          第七章 综合案例
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../07_%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/01_RFM%E4%BC%9A%E5%91%98%E4%BB%B7%E5%80%BC%E5%BA%A6%E6%A8%A1%E5%9E%8B%E6%A1%88%E4%BE%8B.html" class="md-nav__link">
        1 RFM会员价值度模型案例
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    学习目标
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1 聚合
  </a>
  
    <nav class="md-nav" aria-label="1 聚合">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1 单变量分组聚合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-pandas" class="md-nav__link">
    1.2 Pandas内置的聚合方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3 聚合函数
  </a>
  
    <nav class="md-nav" aria-label="1.3 聚合函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    自定义函数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    1.4 同时传入多个函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-aggaggregate" class="md-nav__link">
    1.5 向agg/aggregate中传入字典
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2 转换
  </a>
  
    <nav class="md-nav" aria-label="2 转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-transform" class="md-nav__link">
    2.1 transform分组填充缺失值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-transformz" class="md-nav__link">
    2.2 使用transform分组计算z分数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3 过滤
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-dataframegroupby" class="md-nav__link">
    4 DataFrameGroupBy对象
  </a>
  
    <nav class="md-nav" aria-label="4 DataFrameGroupBy对象">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1 分组
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    4.2 遍历分组
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    4.3 多个分组
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    小结
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="8">8 数据分组<a class="headerlink" href="#8" title="Permanent link">&para;</a></h1>
<h2 id="_1">学习目标<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li>应用groupby 进行分组,并对分组数据进行聚合,转换和过滤</li>
<li>应用自定义函数处理分组之后的数据</li>
</ul>
<h2 id="1">1 聚合<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<ul>
<li>在SQL中我们经常使用 GROUP BY 将某个字段,按不同的取值进行分组, 在pandas中也有groupby函数</li>
<li>分组之后,每组都会有至少1条数据, 将这些数据进一步处理返回单个值的过程就是聚合,比如 分组之后计算算术平均值, 或者分组之后计算频数,都属于聚合</li>
</ul>
<h3 id="11">1.1 单变量分组聚合<a class="headerlink" href="#11" title="Permanent link">&para;</a></h3>
<ul>
<li>在之前的课程中,我们介绍了使用Gapminder数据集分组计算平均值</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/gapminder.tsv&#39;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">df</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">country</th>
<th align="right">continent</th>
<th align="right">year</th>
<th align="right">lifeExp</th>
<th align="right">pop</th>
<th align="right">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">Afghanistan</td>
<td align="right">Asia</td>
<td align="right">1952</td>
<td align="right">28.801</td>
<td align="right">8425333</td>
<td align="right">779.445314</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">Afghanistan</td>
<td align="right">Asia</td>
<td align="right">1957</td>
<td align="right">30.332</td>
<td align="right">9240934</td>
<td align="right">820.853030</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">Afghanistan</td>
<td align="right">Asia</td>
<td align="right">1962</td>
<td align="right">31.997</td>
<td align="right">10267083</td>
<td align="right">853.100710</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">Afghanistan</td>
<td align="right">Asia</td>
<td align="right">1967</td>
<td align="right">34.020</td>
<td align="right">11537966</td>
<td align="right">836.197138</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">Afghanistan</td>
<td align="right">Asia</td>
<td align="right">1972</td>
<td align="right">36.088</td>
<td align="right">13079460</td>
<td align="right">739.981106</td>
</tr>
<tr>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
</tr>
<tr>
<td align="right">1699</td>
<td align="right">Zimbabwe</td>
<td align="right">Africa</td>
<td align="right">1987</td>
<td align="right">62.351</td>
<td align="right">9216418</td>
<td align="right">706.157306</td>
</tr>
<tr>
<td align="right">1700</td>
<td align="right">Zimbabwe</td>
<td align="right">Africa</td>
<td align="right">1992</td>
<td align="right">60.377</td>
<td align="right">10704340</td>
<td align="right">693.420786</td>
</tr>
<tr>
<td align="right">1701</td>
<td align="right">Zimbabwe</td>
<td align="right">Africa</td>
<td align="right">1997</td>
<td align="right">46.809</td>
<td align="right">11404948</td>
<td align="right">792.449960</td>
</tr>
<tr>
<td align="right">1702</td>
<td align="right">Zimbabwe</td>
<td align="right">Africa</td>
<td align="right">2002</td>
<td align="right">39.989</td>
<td align="right">11926563</td>
<td align="right">672.038623</td>
</tr>
<tr>
<td align="right">1703</td>
<td align="right">Zimbabwe</td>
<td align="right">Africa</td>
<td align="right">2007</td>
<td align="right">43.487</td>
<td align="right">12311143</td>
<td align="right">469.709298</td>
</tr>
</tbody>
</table>
<p>1704 rows × 6 columns</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>year
<span class="m">1952</span>    <span class="m">49</span>.057620
<span class="m">1957</span>    <span class="m">51</span>.507401
<span class="m">1962</span>    <span class="m">53</span>.609249
<span class="m">1967</span>    <span class="m">55</span>.678290
<span class="m">1972</span>    <span class="m">57</span>.647386
<span class="m">1977</span>    <span class="m">59</span>.570157
<span class="m">1982</span>    <span class="m">61</span>.533197
<span class="m">1987</span>    <span class="m">63</span>.212613
<span class="m">1992</span>    <span class="m">64</span>.160338
<span class="m">1997</span>    <span class="m">65</span>.014676
<span class="m">2002</span>    <span class="m">65</span>.694923
<span class="m">2007</span>    <span class="m">67</span>.007423
Name: lifeExp, dtype: float64
</code></pre></div>
</blockquote>
<ul>
<li>groupby语句创建了若干组,例如上面例子中, 对year字段分组, 会将数据中不同年份作为分组结果</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">years</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">years</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>array([1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, 2002,
  2007], dtype=int64)
</code></pre></div>
</blockquote>
<ul>
<li>上面groupby 之后去平均的结果,也可以手动计算</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 针对1952年的数据取子集</span>
<span class="n">y1952</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="o">==</span><span class="mi">1952</span><span class="p">,:]</span>
<span class="n">y1952</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">country</th>
<th align="right">continent</th>
<th align="right">year</th>
<th align="right">lifeExp</th>
<th align="right">pop</th>
<th align="right">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">Afghanistan</td>
<td align="right">Asia</td>
<td align="right">1952</td>
<td align="right">28.801</td>
<td align="right">8425333</td>
<td align="right">779.445314</td>
</tr>
<tr>
<td align="right">12</td>
<td align="right">Albania</td>
<td align="right">Europe</td>
<td align="right">1952</td>
<td align="right">55.230</td>
<td align="right">1282697</td>
<td align="right">1601.056136</td>
</tr>
<tr>
<td align="right">24</td>
<td align="right">Algeria</td>
<td align="right">Africa</td>
<td align="right">1952</td>
<td align="right">43.077</td>
<td align="right">9279525</td>
<td align="right">2449.008185</td>
</tr>
<tr>
<td align="right">36</td>
<td align="right">Angola</td>
<td align="right">Africa</td>
<td align="right">1952</td>
<td align="right">30.015</td>
<td align="right">4232095</td>
<td align="right">3520.610273</td>
</tr>
<tr>
<td align="right">48</td>
<td align="right">Argentina</td>
<td align="right">Americas</td>
<td align="right">1952</td>
<td align="right">62.485</td>
<td align="right">17876956</td>
<td align="right">5911.315053</td>
</tr>
<tr>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
</tr>
<tr>
<td align="right">1644</td>
<td align="right">Vietnam</td>
<td align="right">Asia</td>
<td align="right">1952</td>
<td align="right">40.412</td>
<td align="right">26246839</td>
<td align="right">605.066492</td>
</tr>
<tr>
<td align="right">1656</td>
<td align="right">West Bank and Gaza</td>
<td align="right">Asia</td>
<td align="right">1952</td>
<td align="right">43.160</td>
<td align="right">1030585</td>
<td align="right">1515.592329</td>
</tr>
<tr>
<td align="right">1668</td>
<td align="right">Yemen, Rep.</td>
<td align="right">Asia</td>
<td align="right">1952</td>
<td align="right">32.548</td>
<td align="right">4963829</td>
<td align="right">781.717576</td>
</tr>
<tr>
<td align="right">1680</td>
<td align="right">Zambia</td>
<td align="right">Africa</td>
<td align="right">1952</td>
<td align="right">42.038</td>
<td align="right">2672000</td>
<td align="right">1147.388831</td>
</tr>
<tr>
<td align="right">1692</td>
<td align="right">Zimbabwe</td>
<td align="right">Africa</td>
<td align="right">1952</td>
<td align="right">48.451</td>
<td align="right">3080907</td>
<td align="right">406.884115</td>
</tr>
</tbody>
</table>
<p>142 rows × 6 columns</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">y1952</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code><span class="m">49</span>.05761971830987
</code></pre></div>
</blockquote>
<ul>
<li>groupby 语句会针对每个不同年份重复上述过程,并把所有结果放入一个DataFrame中返回</li>
<li>mean函数不是唯一的聚合函数, Pandas内置了许多方法, 都可以与groupby语句搭配使用</li>
</ul>
<h3 id="12-pandas">1.2 Pandas内置的聚合方法<a class="headerlink" href="#12-pandas" title="Permanent link">&para;</a></h3>
<ul>
<li>可以与groupby一起使用的方法和函数</li>
</ul>
<table>
<thead>
<tr>
<th>Pandas方法</th>
<th>Numpy函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>count</td>
<td>np.count_nonzero</td>
<td>频率统计(不包含NaN值)</td>
</tr>
<tr>
<td>size</td>
<td></td>
<td>频率统计(包含NaN值)</td>
</tr>
<tr>
<td>mean</td>
<td>np.mean</td>
<td>求平均值</td>
</tr>
<tr>
<td>std</td>
<td>np.std</td>
<td>标准差</td>
</tr>
<tr>
<td>min</td>
<td>np.min</td>
<td>最小值</td>
</tr>
<tr>
<td>quantile()</td>
<td>np.percentile()</td>
<td>分位数</td>
</tr>
<tr>
<td>max</td>
<td>np.max</td>
<td>求最大值</td>
</tr>
<tr>
<td>sum</td>
<td>np.sum</td>
<td>求和</td>
</tr>
<tr>
<td>var</td>
<td>np.var</td>
<td>方差</td>
</tr>
<tr>
<td>describe</td>
<td></td>
<td>计数、平均值、标准差，最小值、分位数、最大值</td>
</tr>
<tr>
<td>first</td>
<td></td>
<td>返回第一行</td>
</tr>
<tr>
<td>last</td>
<td></td>
<td>返回最后一行</td>
</tr>
<tr>
<td>nth</td>
<td></td>
<td>返回第N行(Python从0开始计数)</td>
</tr>
</tbody>
</table>
<ul>
<li>上面的结果是分组之后取平均, 也可以使用describe函数同时计算多个统计量</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right">continent</th>
<th align="right">count</th>
<th align="right">mean</th>
<th align="right">std</th>
<th align="right">min</th>
<th align="right">25%</th>
<th align="right">50%</th>
<th align="right">75%</th>
<th align="right">max</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">Africa</td>
<td align="right">624.0</td>
<td align="right">48.865330</td>
<td align="right">9.150210</td>
<td align="right">23.599</td>
<td align="right">42.37250</td>
<td align="right">47.7920</td>
<td align="right">54.41150</td>
<td align="right">76.442</td>
</tr>
<tr>
<td align="right">Americas</td>
<td align="right">300.0</td>
<td align="right">64.658737</td>
<td align="right">9.345088</td>
<td align="right">37.579</td>
<td align="right">58.41000</td>
<td align="right">67.0480</td>
<td align="right">71.69950</td>
<td align="right">80.653</td>
</tr>
<tr>
<td align="right">Asia</td>
<td align="right">396.0</td>
<td align="right">60.064903</td>
<td align="right">11.864532</td>
<td align="right">28.801</td>
<td align="right">51.42625</td>
<td align="right">61.7915</td>
<td align="right">69.50525</td>
<td align="right">82.603</td>
</tr>
<tr>
<td align="right">Europe</td>
<td align="right">360.0</td>
<td align="right">71.903686</td>
<td align="right">5.433178</td>
<td align="right">43.585</td>
<td align="right">69.57000</td>
<td align="right">72.2410</td>
<td align="right">75.45050</td>
<td align="right">81.757</td>
</tr>
<tr>
<td align="right">Oceania</td>
<td align="right">24.0</td>
<td align="right">74.326208</td>
<td align="right">3.795611</td>
<td align="right">69.120</td>
<td align="right">71.20500</td>
<td align="right">73.6650</td>
<td align="right">77.55250</td>
<td align="right">81.235</td>
</tr>
</tbody>
</table>
</blockquote>
<h3 id="13">1.3 聚合函数<a class="headerlink" href="#13" title="Permanent link">&para;</a></h3>
<ul>
<li>可以使用Numpy库的mean函数</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>continent
Africa      <span class="m">48</span>.865330
Americas    <span class="m">64</span>.658737
Asia        <span class="m">60</span>.064903
Europe      <span class="m">71</span>.903686
Oceania     <span class="m">74</span>.326208
Name: lifeExp, dtype: float64
</code></pre></div>
</blockquote>
<ul>
<li>agg和 aggregate效果一样</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>continent
Africa      <span class="m">48</span>.865330
Americas    <span class="m">64</span>.658737
Asia        <span class="m">60</span>.064903
Europe      <span class="m">71</span>.903686
Oceania     <span class="m">74</span>.326208
Name: lifeExp, dtype: float64
</code></pre></div>
</blockquote>
<h4 id="_2">自定义函数<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<ul>
<li>如果想在聚合的时候,使用非Pandas或其他库提供的计算, 可以自定义函数,然后再aggregate中调用它</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">my_mean</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;计算平均值</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="c1"># 获取数据条目数</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="nb">sum</span> <span class="o">+=</span> <span class="n">value</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">sum</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
<span class="c1"># 调用自定义函数</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">my_mean</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>year
<span class="m">1952</span>    <span class="m">49</span>.057620
<span class="m">1957</span>    <span class="m">51</span>.507401
<span class="m">1962</span>    <span class="m">53</span>.609249
<span class="m">1967</span>    <span class="m">55</span>.678290
<span class="m">1972</span>    <span class="m">57</span>.647386
<span class="m">1977</span>    <span class="m">59</span>.570157
<span class="m">1982</span>    <span class="m">61</span>.533197
<span class="m">1987</span>    <span class="m">63</span>.212613
<span class="m">1992</span>    <span class="m">64</span>.160338
<span class="m">1997</span>    <span class="m">65</span>.014676
<span class="m">2002</span>    <span class="m">65</span>.694923
<span class="m">2007</span>    <span class="m">67</span>.007423
Name: lifeExp, dtype: float64
</code></pre></div>
</blockquote>
<ul>
<li>自定义函数中只有一个参数values, 但传入该函数中的数据是一组值, 需要对values进行迭代才能取出每一个值</li>
<li>自定义函数可以有多个参数, 第一个参数接受来自DataFrame分组这之后的值, 其余参数可自定义</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 计算全球平均预期寿命的平均值 与分组之后的平均值做差</span>
<span class="k">def</span> <span class="nf">my_mean_diff</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="n">diff_value</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;计算平均值和diff_value之差</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="nb">sum</span><span class="o">+=</span><span class="n">value</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="nb">sum</span><span class="o">/</span><span class="n">n</span>
    <span class="k">return</span><span class="p">(</span><span class="n">mean</span><span class="o">-</span><span class="n">diff_value</span><span class="p">)</span>
<span class="c1"># 计算整个数据集的平均年龄</span>
<span class="n">global_mean</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="c1"># 调用自定义函数 计算平均值的差值</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">my_mean_diff</span><span class="p">,</span><span class="n">diff_value</span> <span class="o">=</span> <span class="n">global_mean</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>year
<span class="m">1952</span>   -10.416820
<span class="m">1957</span>    -7.967038
<span class="m">1962</span>    -5.865190
<span class="m">1967</span>    -3.796150
<span class="m">1972</span>    -1.827053
<span class="m">1977</span>     <span class="m">0</span>.095718
<span class="m">1982</span>     <span class="m">2</span>.058758
<span class="m">1987</span>     <span class="m">3</span>.738173
<span class="m">1992</span>     <span class="m">4</span>.685899
<span class="m">1997</span>     <span class="m">5</span>.540237
<span class="m">2002</span>     <span class="m">6</span>.220483
<span class="m">2007</span>     <span class="m">7</span>.532983
Name: lifeExp, dtype: float64
</code></pre></div>
</blockquote>
<h3 id="14">1.4 同时传入多个函数<a class="headerlink" href="#14" title="Permanent link">&para;</a></h3>
<ul>
<li>分组之后想计算多个聚合函数,可以把它们全部放入一个Python列表,然后把整个列表传入agg或aggregate中</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 按年计算lifeExp 的非零个数,平均值和标准差</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">count_nonzero</th>
<th align="right">mean</th>
<th align="right">std</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">year</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">1952</td>
<td align="right">142.0</td>
<td align="right">49.057620</td>
<td align="right">12.225956</td>
</tr>
<tr>
<td align="right">1957</td>
<td align="right">142.0</td>
<td align="right">51.507401</td>
<td align="right">12.231286</td>
</tr>
<tr>
<td align="right">1962</td>
<td align="right">142.0</td>
<td align="right">53.609249</td>
<td align="right">12.097245</td>
</tr>
<tr>
<td align="right">1967</td>
<td align="right">142.0</td>
<td align="right">55.678290</td>
<td align="right">11.718858</td>
</tr>
<tr>
<td align="right">1972</td>
<td align="right">142.0</td>
<td align="right">57.647386</td>
<td align="right">11.381953</td>
</tr>
<tr>
<td align="right">1977</td>
<td align="right">142.0</td>
<td align="right">59.570157</td>
<td align="right">11.227229</td>
</tr>
<tr>
<td align="right">1982</td>
<td align="right">142.0</td>
<td align="right">61.533197</td>
<td align="right">10.770618</td>
</tr>
<tr>
<td align="right">1987</td>
<td align="right">142.0</td>
<td align="right">63.212613</td>
<td align="right">10.556285</td>
</tr>
<tr>
<td align="right">1992</td>
<td align="right">142.0</td>
<td align="right">64.160338</td>
<td align="right">11.227380</td>
</tr>
<tr>
<td align="right">1997</td>
<td align="right">142.0</td>
<td align="right">65.014676</td>
<td align="right">11.559439</td>
</tr>
<tr>
<td align="right">2002</td>
<td align="right">142.0</td>
<td align="right">65.694923</td>
<td align="right">12.279823</td>
</tr>
<tr>
<td align="right">2007</td>
<td align="right">142.0</td>
<td align="right">67.007423</td>
<td align="right">12.073021</td>
</tr>
</tbody>
</table>
</blockquote>
<h3 id="15-aggaggregate">1.5 向agg/aggregate中传入字典<a class="headerlink" href="#15-aggaggregate" title="Permanent link">&para;</a></h3>
<ul>
<li>分组之后,可以对多个字段用不同的方式聚合</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">:</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;pop&#39;</span><span class="p">:</span><span class="s1">&#39;median&#39;</span><span class="p">,</span><span class="s1">&#39;gdpPercap&#39;</span><span class="p">:</span><span class="s1">&#39;median&#39;</span><span class="p">})</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">lifeExp</th>
<th align="right">pop</th>
<th align="right">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">year</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">1952</td>
<td align="right">49.057620</td>
<td align="right">3943953.0</td>
<td align="right">1968.528344</td>
</tr>
<tr>
<td align="right">1957</td>
<td align="right">51.507401</td>
<td align="right">4282942.0</td>
<td align="right">2173.220291</td>
</tr>
<tr>
<td align="right">1962</td>
<td align="right">53.609249</td>
<td align="right">4686039.5</td>
<td align="right">2335.439533</td>
</tr>
<tr>
<td align="right">1967</td>
<td align="right">55.678290</td>
<td align="right">5170175.5</td>
<td align="right">2678.334741</td>
</tr>
<tr>
<td align="right">1972</td>
<td align="right">57.647386</td>
<td align="right">5877996.5</td>
<td align="right">3339.129407</td>
</tr>
<tr>
<td align="right">1977</td>
<td align="right">59.570157</td>
<td align="right">6404036.5</td>
<td align="right">3798.609244</td>
</tr>
<tr>
<td align="right">1982</td>
<td align="right">61.533197</td>
<td align="right">7007320.0</td>
<td align="right">4216.228428</td>
</tr>
<tr>
<td align="right">1987</td>
<td align="right">63.212613</td>
<td align="right">7774861.5</td>
<td align="right">4280.300366</td>
</tr>
<tr>
<td align="right">1992</td>
<td align="right">64.160338</td>
<td align="right">8688686.5</td>
<td align="right">4386.085502</td>
</tr>
<tr>
<td align="right">1997</td>
<td align="right">65.014676</td>
<td align="right">9735063.5</td>
<td align="right">4781.825478</td>
</tr>
<tr>
<td align="right">2002</td>
<td align="right">65.694923</td>
<td align="right">10372918.5</td>
<td align="right">5319.804524</td>
</tr>
<tr>
<td align="right">2007</td>
<td align="right">67.007423</td>
<td align="right">10517531.0</td>
<td align="right">6124.371109</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>从聚合之后返回的DataFrame中发现, 聚合后的列名就是聚合函数的名字, 可以通过rename进行重命名</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">:</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;pop&#39;</span><span class="p">:</span><span class="s1">&#39;median&#39;</span><span class="p">,</span><span class="s1">&#39;gdpPercap&#39;</span><span class="p">:</span><span class="s1">&#39;median&#39;</span><span class="p">})</span><span class="o">.</span>\
    <span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lifeExp&#39;</span><span class="p">:</span><span class="s1">&#39;平均寿命&#39;</span><span class="p">,</span><span class="s1">&#39;pop&#39;</span><span class="p">:</span><span class="s1">&#39;人口&#39;</span><span class="p">,</span><span class="s1">&#39;gdpPercap&#39;</span><span class="p">:</span><span class="s1">&#39;人均Gdp&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">year</th>
<th align="right">平均寿命</th>
<th align="right">人口</th>
<th align="right">人均Gdp</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">1952</td>
<td align="right">49.057620</td>
<td align="right">3943953.0</td>
<td align="right">1968.528344</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">1957</td>
<td align="right">51.507401</td>
<td align="right">4282942.0</td>
<td align="right">2173.220291</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">1962</td>
<td align="right">53.609249</td>
<td align="right">4686039.5</td>
<td align="right">2335.439533</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">1967</td>
<td align="right">55.678290</td>
<td align="right">5170175.5</td>
<td align="right">2678.334741</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">1972</td>
<td align="right">57.647386</td>
<td align="right">5877996.5</td>
<td align="right">3339.129407</td>
</tr>
<tr>
<td align="right">5</td>
<td align="right">1977</td>
<td align="right">59.570157</td>
<td align="right">6404036.5</td>
<td align="right">3798.609244</td>
</tr>
<tr>
<td align="right">6</td>
<td align="right">1982</td>
<td align="right">61.533197</td>
<td align="right">7007320.0</td>
<td align="right">4216.228428</td>
</tr>
<tr>
<td align="right">7</td>
<td align="right">1987</td>
<td align="right">63.212613</td>
<td align="right">7774861.5</td>
<td align="right">4280.300366</td>
</tr>
<tr>
<td align="right">8</td>
<td align="right">1992</td>
<td align="right">64.160338</td>
<td align="right">8688686.5</td>
<td align="right">4386.085502</td>
</tr>
<tr>
<td align="right">9</td>
<td align="right">1997</td>
<td align="right">65.014676</td>
<td align="right">9735063.5</td>
<td align="right">4781.825478</td>
</tr>
<tr>
<td align="right">10</td>
<td align="right">2002</td>
<td align="right">65.694923</td>
<td align="right">10372918.5</td>
<td align="right">5319.804524</td>
</tr>
<tr>
<td align="right">11</td>
<td align="right">2007</td>
<td align="right">67.007423</td>
<td align="right">10517531.0</td>
<td align="right">6124.371109</td>
</tr>
</tbody>
</table>
</blockquote>
<h2 id="2">2 转换<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<ul>
<li>transform 转换，需要把DataFrame中的值传递给一个函数， 而后由该函数"转换"数据。</li>
<li>aggregate(聚合) 返回单个聚合值，但transform 不会减少数据量</li>
</ul>
<h3 id="21-transform">2.1 transform分组填充缺失值<a class="headerlink" href="#21-transform" title="Permanent link">&para;</a></h3>
<ul>
<li>之前介绍了填充缺失值的各种方法，对于某些数据集，可以使用列的平均值来填充缺失值。某些情况下，可以考虑将列进行分组，分组之后取平均再填充缺失值</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">tips_10</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/tips_10.csv&#39;</span><span class="p">)</span>
<span class="n">tips_10</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">total_bill</th>
<th align="right">tip</th>
<th align="right">sex</th>
<th align="right">smoker</th>
<th align="right">day</th>
<th align="right">time</th>
<th align="right">size</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">24</td>
<td align="right">19.82</td>
<td align="right">3.18</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sat</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">6</td>
<td align="right">8.77</td>
<td align="right">2.00</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">153</td>
<td align="right">NaN</td>
<td align="right">2.00</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">4</td>
</tr>
<tr>
<td align="right">211</td>
<td align="right">NaN</td>
<td align="right">5.16</td>
<td align="right">Male</td>
<td align="right">Yes</td>
<td align="right">Sat</td>
<td align="right">Dinner</td>
<td align="right">4</td>
</tr>
<tr>
<td align="right">198</td>
<td align="right">NaN</td>
<td align="right">2.00</td>
<td align="right">Female</td>
<td align="right">Yes</td>
<td align="right">Thur</td>
<td align="right">Lunch</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">176</td>
<td align="right">NaN</td>
<td align="right">2.00</td>
<td align="right">Male</td>
<td align="right">Yes</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">192</td>
<td align="right">28.44</td>
<td align="right">2.56</td>
<td align="right">Male</td>
<td align="right">Yes</td>
<td align="right">Thur</td>
<td align="right">Lunch</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">124</td>
<td align="right">12.48</td>
<td align="right">2.52</td>
<td align="right">Female</td>
<td align="right">No</td>
<td align="right">Thur</td>
<td align="right">Lunch</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">9</td>
<td align="right">14.78</td>
<td align="right">3.23</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">101</td>
<td align="right">15.38</td>
<td align="right">3.00</td>
<td align="right">Female</td>
<td align="right">Yes</td>
<td align="right">Fri</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>查看缺失情况</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">count_sex</span> <span class="o">=</span> <span class="n">tips_10</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;sex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">count_sex</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right">sex</th>
<th align="right">total_bill</th>
<th align="right">tip</th>
<th align="right">smoker</th>
<th align="right">day</th>
<th align="right">time</th>
<th align="right">size</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">Female</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
<tr>
<td align="right">Male</td>
<td align="right">4</td>
<td align="right">7</td>
<td align="right">7</td>
<td align="right">7</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>定义函数填充缺失值</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fill_na_mean</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># 求平均</span>
    <span class="n">avg</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="c1"># 填充缺失值</span>
    <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">avg</span><span class="p">))</span>
<span class="n">total_bill_group_mean</span> <span class="o">=</span> <span class="n">tips_10</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;sex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">total_bill</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">fill_na_mean</span><span class="p">)</span>
<span class="n">total_bill_group_mean</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>24     19.8200
6       8.7700
153    17.9525
211    17.9525
198    13.9300
176    17.9525
192    28.4400
124    12.4800
9      14.7800
101    15.3800
Name: total_bill, dtype: float64
</code></pre></div>
</blockquote>
<ul>
<li>将计算的结果赋值新列</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">tips_10</span><span class="p">[</span><span class="s1">&#39;fill_total_bill&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_bill_group_mean</span>
<span class="n">tips_10</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">total_bill</th>
<th align="right">tip</th>
<th align="right">sex</th>
<th align="right">smoker</th>
<th align="right">day</th>
<th align="right">time</th>
<th align="right">size</th>
<th align="right">fill_total_bill</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">24</td>
<td align="right">19.82</td>
<td align="right">3.18</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sat</td>
<td align="right">Dinner</td>
<td align="right">2</td>
<td align="right">19.8200</td>
</tr>
<tr>
<td align="right">6</td>
<td align="right">8.77</td>
<td align="right">2.00</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">2</td>
<td align="right">8.7700</td>
</tr>
<tr>
<td align="right">153</td>
<td align="right">NaN</td>
<td align="right">2.00</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">4</td>
<td align="right">17.9525</td>
</tr>
<tr>
<td align="right">211</td>
<td align="right">NaN</td>
<td align="right">5.16</td>
<td align="right">Male</td>
<td align="right">Yes</td>
<td align="right">Sat</td>
<td align="right">Dinner</td>
<td align="right">4</td>
<td align="right">17.9525</td>
</tr>
<tr>
<td align="right">198</td>
<td align="right">NaN</td>
<td align="right">2.00</td>
<td align="right">Female</td>
<td align="right">Yes</td>
<td align="right">Thur</td>
<td align="right">Lunch</td>
<td align="right">2</td>
<td align="right">13.9300</td>
</tr>
<tr>
<td align="right">176</td>
<td align="right">NaN</td>
<td align="right">2.00</td>
<td align="right">Male</td>
<td align="right">Yes</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">2</td>
<td align="right">17.9525</td>
</tr>
<tr>
<td align="right">192</td>
<td align="right">28.44</td>
<td align="right">2.56</td>
<td align="right">Male</td>
<td align="right">Yes</td>
<td align="right">Thur</td>
<td align="right">Lunch</td>
<td align="right">2</td>
<td align="right">28.4400</td>
</tr>
<tr>
<td align="right">124</td>
<td align="right">12.48</td>
<td align="right">2.52</td>
<td align="right">Female</td>
<td align="right">No</td>
<td align="right">Thur</td>
<td align="right">Lunch</td>
<td align="right">2</td>
<td align="right">12.4800</td>
</tr>
<tr>
<td align="right">9</td>
<td align="right">14.78</td>
<td align="right">3.23</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">2</td>
<td align="right">14.7800</td>
</tr>
<tr>
<td align="right">101</td>
<td align="right">15.38</td>
<td align="right">3.00</td>
<td align="right">Female</td>
<td align="right">Yes</td>
<td align="right">Fri</td>
<td align="right">Dinner</td>
<td align="right">2</td>
<td align="right">15.3800</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>对比total_bill 和 fill_total_bill 发现 Male 和 Female 的填充值不同</li>
</ul>
<h3 id="22-transformz">2.2 使用transform分组计算z分数<a class="headerlink" href="#22-transformz" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 计算z-score   x - 平均值/标准差</span>
<span class="k">def</span> <span class="nf">my_zscore</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="c1">#按年分组 计算z-score</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lifeExp</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">my_zscore</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code><span class="m">0</span>      -1.656854
<span class="m">1</span>      -1.731249
<span class="m">2</span>      -1.786543
<span class="m">3</span>      -1.848157
<span class="m">4</span>      -1.894173
          ...   
<span class="m">1699</span>   -0.081621
<span class="m">1700</span>   -0.336974
<span class="m">1701</span>   -1.574962
<span class="m">1702</span>   -2.093346
<span class="m">1703</span>   -1.948180
Name: lifeExp, Length: <span class="m">1704</span>, dtype: float64
</code></pre></div>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1"># 查看数据集条目数， 跟之前transform处理之后的条目数一样</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code><span class="o">(</span><span class="m">1704</span>, <span class="m">6</span><span class="o">)</span>
</code></pre></div>
</blockquote>
<h2 id="3">3 过滤<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<ul>
<li>使用groupby方法还可以过滤数据，调用filter 方法，传入一个返回布尔值的函数，返回False的数据会被过滤掉</li>
<li>使用之前的小费数据</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">tips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/tips.csv&#39;</span><span class="p">)</span>
<span class="c1"># 查看用餐人数</span>
<span class="n">tips</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>2    156
3     38
4     37
5      5
6      4
1      4
Name: size, dtype: int64
</code></pre></div>
</blockquote>
<ul>
<li>结果显示，人数为1、5和6人的数据比较少，考虑将这部分数据过滤掉</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">tips_filtered</span> <span class="o">=</span> <span class="n">tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">30</span><span class="p">)</span>
<span class="n">tips_filtered</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">total_bill</th>
<th align="right">tip</th>
<th align="right">sex</th>
<th align="right">smoker</th>
<th align="right">day</th>
<th align="right">time</th>
<th align="right">size</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">16.99</td>
<td align="right">1.01</td>
<td align="right">Female</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">10.34</td>
<td align="right">1.66</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">3</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">21.01</td>
<td align="right">3.50</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">3</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">23.68</td>
<td align="right">3.31</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">24.59</td>
<td align="right">3.61</td>
<td align="right">Female</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">4</td>
</tr>
<tr>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
<td align="right">...</td>
</tr>
<tr>
<td align="right">239</td>
<td align="right">29.03</td>
<td align="right">5.92</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sat</td>
<td align="right">Dinner</td>
<td align="right">3</td>
</tr>
<tr>
<td align="right">240</td>
<td align="right">27.18</td>
<td align="right">2.00</td>
<td align="right">Female</td>
<td align="right">Yes</td>
<td align="right">Sat</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">241</td>
<td align="right">22.67</td>
<td align="right">2.00</td>
<td align="right">Male</td>
<td align="right">Yes</td>
<td align="right">Sat</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">242</td>
<td align="right">17.82</td>
<td align="right">1.75</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sat</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">243</td>
<td align="right">18.78</td>
<td align="right">3.00</td>
<td align="right">Female</td>
<td align="right">No</td>
<td align="right">Thur</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>查看结果</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">tips_filtered</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>2    156
3     38
4     37
Name: size, dtype: int64
</code></pre></div>
</blockquote>
<h2 id="4-dataframegroupby">4 DataFrameGroupBy对象<a class="headerlink" href="#4-dataframegroupby" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 分组<a class="headerlink" href="#41" title="Permanent link">&para;</a></h3>
<ul>
<li>准备数据</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">tips_10</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/tips_10.csv&#39;</span><span class="p">)</span>
<span class="n">tips_10</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">total_bill</th>
<th align="right">tip</th>
<th align="right">sex</th>
<th align="right">smoker</th>
<th align="right">day</th>
<th align="right">time</th>
<th align="right">size</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">24</td>
<td align="right">19.82</td>
<td align="right">3.18</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sat</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">6</td>
<td align="right">8.77</td>
<td align="right">2.00</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">153</td>
<td align="right">24.55</td>
<td align="right">2.00</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">4</td>
</tr>
<tr>
<td align="right">211</td>
<td align="right">25.89</td>
<td align="right">5.16</td>
<td align="right">Male</td>
<td align="right">Yes</td>
<td align="right">Sat</td>
<td align="right">Dinner</td>
<td align="right">4</td>
</tr>
<tr>
<td align="right">198</td>
<td align="right">13.00</td>
<td align="right">2.00</td>
<td align="right">Female</td>
<td align="right">Yes</td>
<td align="right">Thur</td>
<td align="right">Lunch</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">176</td>
<td align="right">17.89</td>
<td align="right">2.00</td>
<td align="right">Male</td>
<td align="right">Yes</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">192</td>
<td align="right">28.44</td>
<td align="right">2.56</td>
<td align="right">Male</td>
<td align="right">Yes</td>
<td align="right">Thur</td>
<td align="right">Lunch</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">124</td>
<td align="right">12.48</td>
<td align="right">2.52</td>
<td align="right">Female</td>
<td align="right">No</td>
<td align="right">Thur</td>
<td align="right">Lunch</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">9</td>
<td align="right">14.78</td>
<td align="right">3.23</td>
<td align="right">Male</td>
<td align="right">No</td>
<td align="right">Sun</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">101</td>
<td align="right">15.38</td>
<td align="right">3.00</td>
<td align="right">Female</td>
<td align="right">Yes</td>
<td align="right">Fri</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1"># 调用groupby 创建分组对象</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">tips_10</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;sex&#39;</span><span class="p">)</span>
<span class="n">grouped</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x0000020591F63CF8&gt;
</code></pre></div>
</blockquote>
<ul>
<li>grouped是一个DataFrameGroupBy对象，如果想查看计算过的分组，可以借助groups属性实现</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">grouped</span><span class="o">.</span><span class="n">groups</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code><span class="o">{</span><span class="s1">&#39;Female&#39;</span>: <span class="o">[</span><span class="m">198</span>, <span class="m">124</span>, <span class="m">101</span><span class="o">]</span>, <span class="s1">&#39;Male&#39;</span>: <span class="o">[</span><span class="m">24</span>, <span class="m">6</span>, <span class="m">153</span>, <span class="m">211</span>, <span class="m">176</span>, <span class="m">192</span>, <span class="m">9</span><span class="o">]}</span>
</code></pre></div>
</blockquote>
<ul>
<li>上面返回的结果是DataFrame的索引，实际上就是原始数据的行数</li>
<li>在DataFrameGroupBy对象基础上，直接就可以进行aggregate,transform计算了</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">grouped</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right">sex</th>
<th align="right">total_bill</th>
<th align="right">tip</th>
<th align="right">size</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">Female</td>
<td align="right">13.62</td>
<td align="right">2.506667</td>
<td align="right">2.000000</td>
</tr>
<tr>
<td align="right">Male</td>
<td align="right">20.02</td>
<td align="right">2.875714</td>
<td align="right">2.571429</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<p>上面结果直接计算了按sex分组后，所有列的平均值，但只返回了数值列的结果，非数值列不会计算平均值</p>
</li>
<li>
<p>通过get_group选择分组</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">female</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s1">&#39;Female&#39;</span><span class="p">)</span>
<span class="n">female</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">total_bill</th>
<th align="right">tip</th>
<th align="right">sex</th>
<th align="right">smoker</th>
<th align="right">day</th>
<th align="right">time</th>
<th align="right">size</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">198</td>
<td align="right">13.00</td>
<td align="right">2.00</td>
<td align="right">Female</td>
<td align="right">Yes</td>
<td align="right">Thur</td>
<td align="right">Lunch</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">124</td>
<td align="right">12.48</td>
<td align="right">2.52</td>
<td align="right">Female</td>
<td align="right">No</td>
<td align="right">Thur</td>
<td align="right">Lunch</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">101</td>
<td align="right">15.38</td>
<td align="right">3.00</td>
<td align="right">Female</td>
<td align="right">Yes</td>
<td align="right">Fri</td>
<td align="right">Dinner</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</blockquote>
<h3 id="42">4.2 遍历分组<a class="headerlink" href="#42" title="Permanent link">&para;</a></h3>
<ul>
<li>通过groupby对象，可以遍历所有分组，相比于在groupby之后使用aggregate、transform和filter，有时候使用for循环解决问题更简单</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">sex_group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sex_group</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code><span class="o">(</span><span class="s1">&#39;Female&#39;</span>,      total_bill   tip     sex smoker   day    <span class="nb">time</span>  size
<span class="m">198</span>       <span class="m">13</span>.00  <span class="m">2</span>.00  Female    Yes  Thur   Lunch     <span class="m">2</span>
<span class="m">124</span>       <span class="m">12</span>.48  <span class="m">2</span>.52  Female     No  Thur   Lunch     <span class="m">2</span>
<span class="m">101</span>       <span class="m">15</span>.38  <span class="m">3</span>.00  Female    Yes   Fri  Dinner     <span class="m">2</span><span class="o">)</span>
<span class="o">(</span><span class="s1">&#39;Male&#39;</span>,      total_bill   tip   sex smoker   day    <span class="nb">time</span>  size
<span class="m">24</span>        <span class="m">19</span>.82  <span class="m">3</span>.18  Male     No   Sat  Dinner     <span class="m">2</span>
<span class="m">6</span>          <span class="m">8</span>.77  <span class="m">2</span>.00  Male     No   Sun  Dinner     <span class="m">2</span>
<span class="m">153</span>       <span class="m">24</span>.55  <span class="m">2</span>.00  Male     No   Sun  Dinner     <span class="m">4</span>
<span class="m">211</span>       <span class="m">25</span>.89  <span class="m">5</span>.16  Male    Yes   Sat  Dinner     <span class="m">4</span>
<span class="m">176</span>       <span class="m">17</span>.89  <span class="m">2</span>.00  Male    Yes   Sun  Dinner     <span class="m">2</span>
<span class="m">192</span>       <span class="m">28</span>.44  <span class="m">2</span>.56  Male    Yes  Thur   Lunch     <span class="m">2</span>
<span class="m">9</span>         <span class="m">14</span>.78  <span class="m">3</span>.23  Male     No   Sun  Dinner     <span class="m">2</span><span class="o">)</span>
</code></pre></div>
</blockquote>
<ul>
<li>DataFrameGroupBy对象直接传入索引，会报错</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">grouped</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>---------------------------------------------------------------------------
KeyError                                  Traceback <span class="o">(</span>most recent call last<span class="o">)</span>
&lt;ipython-input-75-2ce84a56ac6b&gt; <span class="k">in</span> &lt;module&gt;<span class="o">()</span>
----&gt; <span class="m">1</span> grouped<span class="o">[</span><span class="m">0</span><span class="o">]</span>

e:<span class="se">\p</span>ython<span class="se">\d</span>ata<span class="se">\l</span>ib<span class="se">\s</span>ite-packages<span class="se">\p</span>andas<span class="se">\c</span>ore<span class="se">\g</span>roupby<span class="se">\g</span>eneric.py <span class="k">in</span> __getitem__<span class="o">(</span>self, key<span class="o">)</span>
   <span class="m">1642</span>                 <span class="nv">stacklevel</span><span class="o">=</span><span class="m">2</span>,
   <span class="m">1643</span>             <span class="o">)</span>
-&gt; <span class="m">1644</span>         <span class="k">return</span> super<span class="o">()</span>.__getitem__<span class="o">(</span>key<span class="o">)</span>
   <span class="m">1645</span> 
   <span class="m">1646</span>     def _gotitem<span class="o">(</span>self, key, ndim: int, <span class="nv">subset</span><span class="o">=</span>None<span class="o">)</span>:

e:<span class="se">\p</span>ython<span class="se">\d</span>ata<span class="se">\l</span>ib<span class="se">\s</span>ite-packages<span class="se">\p</span>andas<span class="se">\c</span>ore<span class="se">\b</span>ase.py <span class="k">in</span> __getitem__<span class="o">(</span>self, key<span class="o">)</span>
    <span class="m">226</span>         <span class="k">else</span>:
    <span class="m">227</span>             <span class="k">if</span> key not <span class="k">in</span> self.obj:
--&gt; <span class="m">228</span>                 raise KeyError<span class="o">(</span>f<span class="s2">&quot;Column not found: {key}&quot;</span><span class="o">)</span>
    <span class="m">229</span>             <span class="k">return</span> self._gotitem<span class="o">(</span>key, <span class="nv">ndim</span><span class="o">=</span><span class="m">1</span><span class="o">)</span>
    <span class="m">230</span> 

KeyError: <span class="s1">&#39;Column not found: 0&#39;</span>
</code></pre></div>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">sex_group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
    <span class="c1">#遍历grouped对象，查看sex_group数据类型</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sex_group</span><span class="p">))</span>
    <span class="c1"># 查看元素个数</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sex_group</span><span class="p">))</span>
    <span class="c1"># 查看第一个元素</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sex_group</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># 查看第一个元素数据类型</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sex_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1"># 查看第二个元素</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sex_group</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># 查看第二个元素数据类型</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sex_group</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">break</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>&lt;class <span class="s1">&#39;tuple&#39;</span>&gt;
<span class="m">2</span>
Female
&lt;class <span class="s1">&#39;str&#39;</span>&gt;
     total_bill   tip     sex smoker   day    <span class="nb">time</span>  size
<span class="m">198</span>       <span class="m">13</span>.00  <span class="m">2</span>.00  Female    Yes  Thur   Lunch     <span class="m">2</span>
<span class="m">124</span>       <span class="m">12</span>.48  <span class="m">2</span>.52  Female     No  Thur   Lunch     <span class="m">2</span>
<span class="m">101</span>       <span class="m">15</span>.38  <span class="m">3</span>.00  Female    Yes   Fri  Dinner     <span class="m">2</span>
&lt;class <span class="s1">&#39;pandas.core.frame.DataFrame&#39;</span>&gt;
</code></pre></div>
</blockquote>
<h3 id="43">4.3 多个分组<a class="headerlink" href="#43" title="Permanent link">&para;</a></h3>
<ul>
<li>前面使用的groupby语句只包含一个变量，可以在groupby中添加多个变量</li>
<li>比如上面用到的消费数据集，可以使用groupby按性别和用餐时间分别计算小费数据的平均值</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">group_avg</span> <span class="o">=</span> <span class="n">tips_10</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">group_avg</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right"></th>
<th align="right">total_bill</th>
<th align="right">tip</th>
<th align="right">size</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">sex</td>
<td align="right">time</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">Female</td>
<td align="right">Dinner</td>
<td align="right">15.380000</td>
<td align="right">3.000000</td>
<td align="right">2.000000</td>
</tr>
<tr>
<td align="right"></td>
<td align="right">Lunch</td>
<td align="right">12.740000</td>
<td align="right">2.260000</td>
<td align="right">2.000000</td>
</tr>
<tr>
<td align="right">Male</td>
<td align="right">Dinner</td>
<td align="right">18.616667</td>
<td align="right">2.928333</td>
<td align="right">2.666667</td>
</tr>
<tr>
<td align="right"></td>
<td align="right">Lunch</td>
<td align="right">28.440000</td>
<td align="right">2.560000</td>
<td align="right">2.000000</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>分别查看分组之后结果的列名和行索引</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">group_avg</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>Index<span class="o">([</span><span class="s1">&#39;total_bill&#39;</span>, <span class="s1">&#39;tip&#39;</span>, <span class="s1">&#39;size&#39;</span><span class="o">]</span>, <span class="nv">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="o">)</span>
</code></pre></div>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">group_avg</span><span class="o">.</span><span class="n">index</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<div class="highlight"><pre><span></span><code>MultiIndex<span class="o">([(</span><span class="s1">&#39;Female&#39;</span>, <span class="s1">&#39;Dinner&#39;</span><span class="o">)</span>,
            <span class="o">(</span><span class="s1">&#39;Female&#39;</span>,  <span class="s1">&#39;Lunch&#39;</span><span class="o">)</span>,
            <span class="o">(</span>  <span class="s1">&#39;Male&#39;</span>, <span class="s1">&#39;Dinner&#39;</span><span class="o">)</span>,
            <span class="o">(</span>  <span class="s1">&#39;Male&#39;</span>,  <span class="s1">&#39;Lunch&#39;</span><span class="o">)]</span>,
           <span class="nv">names</span><span class="o">=[</span><span class="s1">&#39;sex&#39;</span>, <span class="s1">&#39;time&#39;</span><span class="o">])</span>
</code></pre></div>
</blockquote>
<ul>
<li>可以看到，多个分组之后返回的是MultiIndex，如果想得到一个普通的DataFrame，可以在结果上调用reset_index方法</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">group_avg</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">sex</th>
<th align="right">time</th>
<th align="right">total_bill</th>
<th align="right">tip</th>
<th align="right">size</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">Female</td>
<td align="right">Dinner</td>
<td align="right">15.380000</td>
<td align="right">3.000000</td>
<td align="right">2.000000</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">Female</td>
<td align="right">Lunch</td>
<td align="right">12.740000</td>
<td align="right">2.260000</td>
<td align="right">2.000000</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">Male</td>
<td align="right">Dinner</td>
<td align="right">18.616667</td>
<td align="right">2.928333</td>
<td align="right">2.666667</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">Male</td>
<td align="right">Lunch</td>
<td align="right">28.440000</td>
<td align="right">2.560000</td>
<td align="right">2.000000</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>也可以在分组的时候通过as_index = False参数（默认是True），效果与调用reset_index()一样</li>
</ul>
<div class="highlight"><pre><span></span><code> <span class="n">tips_10</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">],</span><span class="n">as_index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p><font color='red'>显示结果:</font></p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">sex</th>
<th align="right">time</th>
<th align="right">total_bill</th>
<th align="right">tip</th>
<th align="right">size</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">Female</td>
<td align="right">Dinner</td>
<td align="right">15.380000</td>
<td align="right">3.000000</td>
<td align="right">2.000000</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">Female</td>
<td align="right">Lunch</td>
<td align="right">12.740000</td>
<td align="right">2.260000</td>
<td align="right">2.000000</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">Male</td>
<td align="right">Dinner</td>
<td align="right">18.616667</td>
<td align="right">2.928333</td>
<td align="right">2.666667</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">Male</td>
<td align="right">Lunch</td>
<td align="right">28.440000</td>
<td align="right">2.560000</td>
<td align="right">2.000000</td>
</tr>
</tbody>
</table>
</blockquote>
<h2 id="_3">小结<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<ul>
<li>分组是数据分析中常见的操作，有助于从不同角度观察数据</li>
<li>分组之后可以得到DataFrameGroupby对象，该对象可以进行聚合、转换、过滤操作</li>
<li>分组之后的数据处理可以使用已有的内置函数，也可以使用自定义函数</li>
<li>分组不但可以对单个字段进行分组，也可以对多个字段进行分组，多个字段分组之后可以得到MultiIndex数据，可以通过reset_index方法将数据变成普通的DataFrame</li>
</ul>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="页脚">
      
        
        <a href="07_apply%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0.html" class="md-footer__link md-footer__link--prev" aria-label="上一页: 7 apply 自定义函数" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              7 apply 自定义函数
            </div>
          </div>
        </a>
      
      
        
        <a href="09_%E6%95%B0%E6%8D%AE%E9%80%8F%E8%A7%86%E8%A1%A8.html" class="md-footer__link md-footer__link--next" aria-label="下一页: 9 数据透视表" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              9 数据透视表
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.1514a9a0.min.js"></script>
      
        <script src="../js/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>