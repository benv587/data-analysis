
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../img/logo.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.6">
    
    
      
        <title>3 MySQL高级 - 数据处理与统计分析 V3.0</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cd566b2a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#3-mysql" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href=".." title="数据处理与统计分析 V3.0" class="md-header__button md-logo" aria-label="数据处理与统计分析 V3.0" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            数据处理与统计分析 V3.0
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3 MySQL高级
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
    <img src="../assets/images/logo.svg" height="45px" alt="logo">

  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="数据处理与统计分析 V3.0" class="md-nav__button md-logo" aria-label="数据处理与统计分析 V3.0" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    数据处理与统计分析 V3.0
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          第一章 Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第一章 Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          第一章 Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01_Linux%E8%AE%B2%E4%B9%89/01_Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.html" class="md-nav__link">
        1 Linux操作系统
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01_Linux%E8%AE%B2%E4%B9%89/02_Linux%E7%B3%BB%E7%BB%9F%E9%AB%98%E7%BA%A7.html" class="md-nav__link">
        2 Linux系统高级
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          第二章 MySQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第二章 MySQL" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          第二章 MySQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%801.html" class="md-nav__link">
        1 MySQL数据库基础I
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%802.html" class="md-nav__link">
        2 MySQL数据库基础II
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          3 MySQL高级
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E7%BA%A7.html" class="md-nav__link md-nav__link--active">
        3 MySQL高级
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    一、窗口函数基本用法
  </a>
  
    <nav class="md-nav" aria-label="一、窗口函数基本用法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1.窗口函数简介
  </a>
  
    <nav class="md-nav" aria-label="1.窗口函数简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1 什么是窗口函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2 窗口函数示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3 窗口函数的优点
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2. 数据集准备
  </a>
  
    <nav class="md-nav" aria-label="2. 数据集准备">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    2.1 创建数据库
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-employee" class="md-nav__link">
    2.2 employee员工信息表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-department" class="md-nav__link">
    2.3 department部门信息表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-purchase" class="md-nav__link">
    2.4 purchase采购信息表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    2.5 所有表字段信息及逻辑关联关系
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3.数据集介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4over" class="md-nav__link">
    4.OVER()基本用法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-over" class="md-nav__link">
    5. 将OVER()的结果用于进一步计算
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6overcount" class="md-nav__link">
    6.OVER()和COUNT()组合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    7.小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    二、排序函数和窗口配合使用
  </a>
  
    <nav class="md-nav" aria-label="二、排序函数和窗口配合使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    1. 数据集准备与介绍
  </a>
  
    <nav class="md-nav" aria-label="1. 数据集准备与介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11_1" class="md-nav__link">
    1.1 数据集准备
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12_1" class="md-nav__link">
    1.2 所有表字段信息及逻辑关联关系
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-rank" class="md-nav__link">
    2. RANK()函数
  </a>
  
    <nav class="md-nav" aria-label="2. RANK()函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_1" class="md-nav__link">
    2.1 示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2 练习
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-dense_rank" class="md-nav__link">
    3. DENSE_RANK()函数
  </a>
  
    <nav class="md-nav" aria-label="3. DENSE_RANK()函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1 示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2 练习
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-row_number" class="md-nav__link">
    4. ROW_NUMBER()函数
  </a>
  
    <nav class="md-nav" aria-label="4. ROW_NUMBER()函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1 示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-1" class="md-nav__link">
    4.2 练习1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-2" class="md-nav__link">
    4.3 练习2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5.小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    三、三范式
  </a>
  
    <nav class="md-nav" aria-label="三、三范式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    1、什么是三范式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    2、数据冗余
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    3、范式的划分
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4、一范式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_1" class="md-nav__link">
    5、二范式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    6、三范式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_1" class="md-nav__link">
    7、小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e-r" class="md-nav__link">
    四、E-R模型及表间关系
  </a>
  
    <nav class="md-nav" aria-label="四、E-R模型及表间关系">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1e-r" class="md-nav__link">
    1、E-R模型的使用场景
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2e-r" class="md-nav__link">
    2、E-R模型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    3、三种关系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    4、小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pymysql" class="md-nav__link">
    五、PyMySQL
  </a>
  
    <nav class="md-nav" aria-label="五、PyMySQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    1、数据准备
  </a>
  
    <nav class="md-nav" aria-label="1、数据准备">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    1 创建数据表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    2 插入数据
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_3" class="md-nav__link">
    3 分表
  </a>
  
    <nav class="md-nav" aria-label="3 分表">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31_1" class="md-nav__link">
    3.1 创建商品分类表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_1" class="md-nav__link">
    3.2 创建商品品牌表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3 修改商品表表结构
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2pymysql" class="md-nav__link">
    2、为什么要学习PyMySQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3pymysql" class="md-nav__link">
    3、PyMySQL的使用
  </a>
  
    <nav class="md-nav" aria-label="3、PyMySQL的使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-pymysql" class="md-nav__link">
    1 导入pymysql包
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    2 创建连接对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_4" class="md-nav__link">
    3 获取游标对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-pymysql" class="md-nav__link">
    4 pymysql完成数据的查询操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-pymysql" class="md-nav__link">
    5 pymysql完成对数据的增删改
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4sql" class="md-nav__link">
    4、SQL注入
  </a>
  
    <nav class="md-nav" aria-label="4、SQL注入">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-sql" class="md-nav__link">
    1. 什么是SQL注入
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-sql" class="md-nav__link">
    2. 非安全方式的SQL语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-sql" class="md-nav__link">
    3. 安全方式的SQL语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_2" class="md-nav__link">
    4. 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          第三章 环境搭建
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第三章 环境搭建" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          第三章 环境搭建
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../03_%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/01_%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" class="md-nav__link">
        1 环境搭建及使用
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          第四章 NumPy
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第四章 NumPy" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          第四章 NumPy
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04_NumPy%E8%AE%B2%E4%B9%89/01_NumPy%E8%AE%B2%E4%B9%89.html" class="md-nav__link">
        1 NumPy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04_NumPy%E8%AE%B2%E4%B9%89/02_%E5%B8%B8%E7%94%A8%E6%A6%82%E5%BF%B5.html" class="md-nav__link">
        2 常用概念
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          第五章 Pandas
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第五章 Pandas" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          第五章 Pandas
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05_Pandas%E8%AE%B2%E4%B9%89/01_Python%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E7%AE%80%E4%BB%8B.html" class="md-nav__link">
        1 Python 数据分析处理简介
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05_Pandas%E8%AE%B2%E4%B9%89/02_Pandas_%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html" class="md-nav__link">
        2 Pandas 数据结构
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05_Pandas%E8%AE%B2%E4%B9%89/03_Pandas_DataFrame%E5%85%A5%E9%97%A8.html" class="md-nav__link">
        3 Pandas DataFrame 入门
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05_Pandas%E8%AE%B2%E4%B9%89/04_Pandas%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%85%A5%E9%97%A8.html" class="md-nav__link">
        4 Pandas 数据分析入门
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05_Pandas%E8%AE%B2%E4%B9%89/05_%E6%95%B0%E6%8D%AE%E7%BB%84%E5%90%88.html" class="md-nav__link">
        5 数据组合
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05_Pandas%E8%AE%B2%E4%B9%89/06_%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97.html" class="md-nav__link">
        6 数据清洗
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05_Pandas%E8%AE%B2%E4%B9%89/07_apply%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0.html" class="md-nav__link">
        7 apply 自定义函数
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05_Pandas%E8%AE%B2%E4%B9%89/08_%E6%95%B0%E6%8D%AE%E5%88%86%E7%BB%84.html" class="md-nav__link">
        8 数据分组
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05_Pandas%E8%AE%B2%E4%B9%89/09_%E6%95%B0%E6%8D%AE%E9%80%8F%E8%A7%86%E8%A1%A8.html" class="md-nav__link">
        9 数据透视表
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05_Pandas%E8%AE%B2%E4%B9%89/10_datetime%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" class="md-nav__link">
        10 datetime 数据类型
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          第六章 数据分析绘图
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第六章 数据分析绘图" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          第六章 数据分析绘图
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06_%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/01_%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%BB%8B%E7%BB%8D.html" class="md-nav__link">
        1 Python数据可视化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06_%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/02_Matplotlib%E7%BB%98%E5%9B%BE.html" class="md-nav__link">
        2 Matplotlib绘图
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06_%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/03_Pandas%E7%BB%98%E5%9B%BE.html" class="md-nav__link">
        3 Pandas绘图
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06_%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E7%BB%98%E5%9B%BE/04_Seaborn%E7%BB%98%E5%9B%BE.html" class="md-nav__link">
        4 Seaborn 可视化
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          第七章 综合案例
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第七章 综合案例" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          第七章 综合案例
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../07_%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/01_RFM%E4%BC%9A%E5%91%98%E4%BB%B7%E5%80%BC%E5%BA%A6%E6%A8%A1%E5%9E%8B%E6%A1%88%E4%BE%8B.html" class="md-nav__link">
        1 RFM会员价值度模型案例
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    一、窗口函数基本用法
  </a>
  
    <nav class="md-nav" aria-label="一、窗口函数基本用法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1.窗口函数简介
  </a>
  
    <nav class="md-nav" aria-label="1.窗口函数简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1 什么是窗口函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2 窗口函数示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3 窗口函数的优点
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2. 数据集准备
  </a>
  
    <nav class="md-nav" aria-label="2. 数据集准备">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    2.1 创建数据库
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-employee" class="md-nav__link">
    2.2 employee员工信息表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-department" class="md-nav__link">
    2.3 department部门信息表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-purchase" class="md-nav__link">
    2.4 purchase采购信息表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    2.5 所有表字段信息及逻辑关联关系
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3.数据集介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4over" class="md-nav__link">
    4.OVER()基本用法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-over" class="md-nav__link">
    5. 将OVER()的结果用于进一步计算
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6overcount" class="md-nav__link">
    6.OVER()和COUNT()组合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    7.小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    二、排序函数和窗口配合使用
  </a>
  
    <nav class="md-nav" aria-label="二、排序函数和窗口配合使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    1. 数据集准备与介绍
  </a>
  
    <nav class="md-nav" aria-label="1. 数据集准备与介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11_1" class="md-nav__link">
    1.1 数据集准备
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12_1" class="md-nav__link">
    1.2 所有表字段信息及逻辑关联关系
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-rank" class="md-nav__link">
    2. RANK()函数
  </a>
  
    <nav class="md-nav" aria-label="2. RANK()函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_1" class="md-nav__link">
    2.1 示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2 练习
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-dense_rank" class="md-nav__link">
    3. DENSE_RANK()函数
  </a>
  
    <nav class="md-nav" aria-label="3. DENSE_RANK()函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1 示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2 练习
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-row_number" class="md-nav__link">
    4. ROW_NUMBER()函数
  </a>
  
    <nav class="md-nav" aria-label="4. ROW_NUMBER()函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1 示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-1" class="md-nav__link">
    4.2 练习1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-2" class="md-nav__link">
    4.3 练习2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5.小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    三、三范式
  </a>
  
    <nav class="md-nav" aria-label="三、三范式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    1、什么是三范式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    2、数据冗余
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    3、范式的划分
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4、一范式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_1" class="md-nav__link">
    5、二范式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    6、三范式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_1" class="md-nav__link">
    7、小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e-r" class="md-nav__link">
    四、E-R模型及表间关系
  </a>
  
    <nav class="md-nav" aria-label="四、E-R模型及表间关系">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1e-r" class="md-nav__link">
    1、E-R模型的使用场景
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2e-r" class="md-nav__link">
    2、E-R模型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    3、三种关系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    4、小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pymysql" class="md-nav__link">
    五、PyMySQL
  </a>
  
    <nav class="md-nav" aria-label="五、PyMySQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    1、数据准备
  </a>
  
    <nav class="md-nav" aria-label="1、数据准备">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    1 创建数据表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    2 插入数据
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_3" class="md-nav__link">
    3 分表
  </a>
  
    <nav class="md-nav" aria-label="3 分表">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31_1" class="md-nav__link">
    3.1 创建商品分类表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_1" class="md-nav__link">
    3.2 创建商品品牌表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3 修改商品表表结构
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2pymysql" class="md-nav__link">
    2、为什么要学习PyMySQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3pymysql" class="md-nav__link">
    3、PyMySQL的使用
  </a>
  
    <nav class="md-nav" aria-label="3、PyMySQL的使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-pymysql" class="md-nav__link">
    1 导入pymysql包
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    2 创建连接对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_4" class="md-nav__link">
    3 获取游标对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-pymysql" class="md-nav__link">
    4 pymysql完成数据的查询操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-pymysql" class="md-nav__link">
    5 pymysql完成对数据的增删改
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4sql" class="md-nav__link">
    4、SQL注入
  </a>
  
    <nav class="md-nav" aria-label="4、SQL注入">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-sql" class="md-nav__link">
    1. 什么是SQL注入
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-sql" class="md-nav__link">
    2. 非安全方式的SQL语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-sql" class="md-nav__link">
    3. 安全方式的SQL语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_2" class="md-nav__link">
    4. 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="3-mysql">3 MySQL高级<a class="headerlink" href="#3-mysql" title="Permanent link">&para;</a></h1>
<p><strong>学习目标</strong></p>
<ul>
<li>掌握窗口函数的基本语法和OVER()的使用方法</li>
<li>掌握RANK、DENSE_RANK、ROW_NUMBER函数的使用方法</li>
<li>知道RANK、DENSE_RANK、ROW_NUMBER的不同之处</li>
<li>能够说出如何避免 SQL 注入问题</li>
</ul>
<h2 id="_1">一、窗口函数基本用法<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="1">1.窗口函数简介<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<p>接下来的课程中我们来介绍**窗口函数window functions**.</p>
<ul>
<li>
<p>MYSQL 8.0 之后，加入了窗口函数功能，简化了数据分析工作中查询语句的书写</p>
</li>
<li>
<p>在没有窗口函数之前，我们需要通过定义临时变量和大量的子查询才能完成的工作，使用窗口函数实现起来更加简洁高效</p>
</li>
<li>
<p>窗口函数是数据分析工作中必须掌握的工具，在SQL笔试中也是高频考点</p>
</li>
<li>
<p>什么是窗口函数? 为什么说窗口函数可以使复杂的查询变得更加简单方便？</p>
</li>
</ul>
<h4 id="11">1.1 什么是窗口函数<a class="headerlink" href="#11" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>窗口函数是类似于可以返回聚合值的函数，例如SUM()，COUNT()，MAX()。但是窗口函数又与普通的聚合函数不同，它不会对结果进行分组，使得输出中的行数与输入中的行数相同。</p>
</li>
<li>
<p>一个窗口函数大概看起来是这样：</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">SUM</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">___</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="n">BY___</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">Table</span><span class="w"> </span>
</code></pre></div>
<p>这里有3点需要牢记：</p>
<ul>
<li>聚合功能：在上述例子中，我们用了SUM()，但是你也可以用COUNT(), AVG()之类的计算功能</li>
<li>PARTITION BY：你只需将它看成GROUP BY子句，但是在窗口函数中，你要写PARTITION BY</li>
<li>ORDER BY：ORDER BY和普通查询语句中的ORDER BY没什么不同。注意，输出的顺序要仔细考虑</li>
</ul>
<h4 id="12">1.2 窗口函数示例<a class="headerlink" href="#12" title="Permanent link">&para;</a></h4>
<p>示例：集合函数VS窗口函数</p>
<p>假设我们有如下这个表格：</p>
<p><img alt="窗口函数-1" src="img/%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0-1.png" /></p>
<p>如果要按性别获取平均GPA，可以使用聚合函数并运行以下查询：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">Gender</span><span class="p">,</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">GPA</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_gpa</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Gender</span><span class="w"></span>
</code></pre></div>
<p>结果如下：</p>
<p><img alt="窗口函数-2" src="img/%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0-2.png" /></p>
<p>现在我们想得到如下结果：</p>
<p><img alt="窗口函数-3" src="img/%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0-3.png" /></p>
<p>我们当然可以用我们刚刚提到的聚合函数，然后再将结果join到初始表，但这需要两个步骤。但如果我们使用窗口函数，我们则可以一步到位，并得到相同的结果：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">GPA</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Gender</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_gpa</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">students</span><span class="w"> </span>
</code></pre></div>
<p>通过上面的查询，就按性别对数据进行划分，并计算每种性别的平均GPA。然后，它将创建一个称为<code>avg_gpa</code>的新列，并为每行附加关联的平均GPA</p>
<h4 id="13">1.3 窗口函数的优点<a class="headerlink" href="#13" title="Permanent link">&para;</a></h4>
<ul>
<li>简单，窗口函数更易于使用。在上面的示例中，与使用聚合函数然后合并结果相比，使用窗口函数仅需要多一行就可以获得所需要的结果。</li>
<li>快速，这一点与上一点相关，使用窗口函数比使用替代方法要快得多。当你处理成百上千个千兆字节的数据时，这非常有用。</li>
<li>多功能性，最重要的是，窗口函数具有多种功能，比如，添加移动平均线，添加行号和滞后数据，等等。</li>
</ul>
<h3 id="2">2. 数据集准备<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>本节我们先介绍窗口函数中最重要的关键字 OVER</p>
</li>
<li>
<p>在介绍具体内容之前先熟悉一下要用到的数据，我们选择了很常见的业务来介绍窗口函数的使用</p>
</li>
<li>
<p>三张表：员工表，部门表，采购表</p>
</li>
<li>员工表：员工id，姓名，员工所属部门id（<code>department_id</code>），工资（<code>salary</code>），工龄（<code>years_worked</code>)</li>
<li>部门表：部门id，部门名称 </li>
<li>采购表：每个部门（<code>department_id</code>）采购的物品明细（<code>item</code>)，物品价格（<code>price</code>）</li>
</ul>
<h4 id="21">2.1 创建数据库<a class="headerlink" href="#21" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">charset</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span><span class="w"></span>
<span class="n">use</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<h4 id="22-employee">2.2 employee员工信息表<a class="headerlink" href="#22-employee" title="Permanent link">&para;</a></h4>
<ul>
<li>建表 employee</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">employee</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">first_name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">last_name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">department_id</span><span class="w">  </span><span class="n">tinyint</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">salary</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">years_worked</span><span class="w">  </span><span class="n">tinyint</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</code></pre></div>
<ul>
<li>写入数据</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">values</span><span class="w"></span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Diane&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Turner&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5330</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Clarence&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Robinson&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3617</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Eugene&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Phillips&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4877</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Philip&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Mitchell&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5259</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ann&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Wright&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2094</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Charles&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Wilson&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5167</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Russell&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Johnson&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3762</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Jacqueline&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Cook&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">6923</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Larry&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Lee&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2796</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Willie&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Patterson&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4771</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Janet&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ramirez&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3782</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Doris&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Bryant&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6419</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Amy&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Williams&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6261</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Keith&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Scott&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4928</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Karen&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Morris&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6347</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Kathy&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Sanders&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6286</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Joe&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Thompson&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">5639</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Barbara&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Clark&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">3232</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Todd&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Bell&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">4653</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ronald&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Butler&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">2076</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
<span class="p">;</span><span class="w"></span>
</code></pre></div>
<ul>
<li>employee员工信息表字段说明</li>
<li>id 员工id</li>
<li>first_name 员工名字</li>
<li>last_name 员工的姓</li>
<li>department_id  员工所属部门id</li>
<li>salary 员工工资</li>
<li>years_worked 工龄</li>
</ul>
<h4 id="23-department">2.3 department部门信息表<a class="headerlink" href="#23-department" title="Permanent link">&para;</a></h4>
<ul>
<li>建表 department</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">department</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</code></pre></div>
<ul>
<li>写入数据</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">department</span><span class="w"> </span><span class="k">values</span><span class="w"></span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;IT&#39;</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Management&#39;</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Human Resources&#39;</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Accounting&#39;</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Help Desk&#39;</span><span class="p">)</span><span class="w"></span>
<span class="p">;</span><span class="w"></span>
</code></pre></div>
<ul>
<li>department部门信息表字段说明</li>
<li>id 部门id</li>
<li>name 部门名称</li>
</ul>
<h4 id="24-purchase">2.4 purchase采购信息表<a class="headerlink" href="#24-purchase" title="Permanent link">&para;</a></h4>
<ul>
<li>建表 purchase</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">purchase</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">department_id</span><span class="w"> </span><span class="n">tinyint</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">item</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">price</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</code></pre></div>
<ul>
<li>写入数据</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">purchase</span><span class="w"> </span><span class="k">values</span><span class="w"></span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;monitor&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">531</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;printer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">315</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;whiteboard&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">170</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;training&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">117</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;computer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2190</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;monitor&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">418</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;whiteboard&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">120</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;monitor&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">388</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;paper&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">37</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;paper&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">695</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;projector&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">407</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;garden party&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">986</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;projector&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">481</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;chair&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">180</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;desk&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">854</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;post-it&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;paper&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;tv&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">943</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;desk&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">478</span><span class="p">),</span><span class="w"></span>
<span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;keyboard&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">214</span><span class="p">)</span><span class="w"></span>
<span class="p">;</span><span class="w"></span>
</code></pre></div>
<ul>
<li>purchase采购信息表字段说明</li>
<li>id 采购信息id</li>
<li>department_id 进行采购的部门id</li>
<li>item 采购物品名称</li>
<li>price 采购物品价格</li>
</ul>
<h4 id="25">2.5 所有表字段信息及逻辑关联关系<a class="headerlink" href="#25" title="Permanent link">&para;</a></h4>
<p><img alt="窗口函数关系表1" src="img/%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E5%85%B3%E7%B3%BB%E8%A1%A81.png" /></p>
<h3 id="3">3.数据集介绍<a class="headerlink" href="#3" title="Permanent link">&para;</a></h3>
<ul>
<li>本小结我们先介绍窗口函数中最重要的关键字 OVER()</li>
<li>在介绍具体内容之前先熟悉一下要用到的数据，我们选择了很常见的业务来介绍窗口函数的使用</li>
<li>三张表：员工表，部门表，采购表</li>
<li>员工表：员工id，姓名，员工所属部门id（<code>department_id</code>），工资（<code>salary</code>），工龄（<code>years_worked</code>)</li>
<li>部门表：部门id，部门名称 </li>
<li>采购表：每个部门（<code>department_id</code>）采购的物品明细（<code>item</code>)，物品价格（<code>price</code>）</li>
</ul>
<p><strong>员工表（employee）</strong></p>
<p><img alt="image-20211120184808370" src="img/image-20211120184808370.png" /></p>
<p><strong>部门表（DEPARTMENT）</strong></p>
<p><img alt="image-20211120184834028" src="img/image-20211120184834028.png" /></p>
<p><strong>采购表（purchase)</strong></p>
<p><img alt="image-20211120184857846" src="img/image-20211120184857846.png" /></p>
<p>要用到的数据已经熟悉了，接下来我们使用上面的数据来介绍窗口函数</p>
<ul>
<li>
<p>窗口函数是对表中**一组数据**进行计算的函数，**一组数据**跟当前行相关</p>
</li>
<li>
<p>例如：想计算每三天的销售总金额，就可以使用窗口函数，以当前行为基准，选前一行，后一行，三行一组如下图所示。之所以称之为窗口函数，是因为好像有一个固定大小的窗框划过数据集，滑动一次取一次，对窗口内的数据进行处理</p>
</li>
</ul>
<p><img src="img/window-functions-window-functions-part2-ex4.gif" alt="animated_explanation" align="center" /></p>
<ul>
<li>看下窗口函数的语法：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="n">window_function</span><span class="o">&gt;</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(...)</span><span class="w"></span>

<span class="o">&lt;</span><span class="n">window_function</span><span class="o">&gt;</span><span class="w"> </span><span class="err">这里可以是我们之前已经学过的聚合函数，比如（</span><span class="k">COUNT</span><span class="p">(),</span><span class="w"> </span><span class="k">SUM</span><span class="p">(),</span><span class="w"> </span><span class="k">AVG</span><span class="p">()</span><span class="err">等等）</span><span class="w"></span>
<span class="err">也以是其他函数，比如</span><span class="n">ranking</span><span class="w"> </span><span class="err">排序函数，分析函数等，后面的课程中会介绍</span><span class="w"></span>
<span class="n">OVER</span><span class="p">(...)</span><span class="w">  </span><span class="err">窗口函数的窗框通过</span><span class="n">OVER</span><span class="p">(...)</span><span class="err">子句定义，窗口函数中很重要的部分就是通过</span><span class="n">OVER</span><span class="p">(...)</span><span class="w">  </span><span class="err">定义窗框</span><span class="w"> </span><span class="p">(</span><span class="err">开窗方式和大小</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<h3 id="4over">4.OVER()基本用法<a class="headerlink" href="#4over" title="Permanent link">&para;</a></h3>
<ul>
<li>首先看<code>OVER (...)</code> 的最基本用法：  <code>OVER()</code>  意思是所有的数据都在窗口中，看下面的SQL</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">first_name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">last_name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">salary</span><span class="p">,</span><span class="w">  </span>
<span class="w">  </span><span class="k">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<ul>
<li>SQL并不复杂，主要看跟  <code>OVER()</code>  相关的部分</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<ul>
<li><code>AVG(salary)</code>  意思是要计算平均工资，加上  <code>OVER()</code>  意味着对全部数据进行计算，所以就是在计算所有人的平均工资</li>
<li>需要注意的是，我们没有使用<code>GROUP BY</code>进行分组，这样在查询结果中除了聚合函数的结果之外，我们还可以显示其他数据</li>
<li>如果使用<code>GROUP BY</code>  想将聚合结果与原始数据放到一个结果中，需要使用子查询，效率相对低</li>
</ul>
<p><strong>练习1</strong></p>
<ul>
<li>需求：创建报表，除了查询每个人的工资之外，还要统计出公司每月的工资支出</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">first_name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">last_name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">salary</span><span class="p">,</span><span class="w">  </span>
<span class="w">  </span><span class="k">SUM</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p><strong>查询结果</strong></p>
<p><img alt="image-20211128151458381" src="img/image-20211128151458381.png" /></p>
<p><strong>练习2</strong></p>
<ul>
<li>需求：统计采购表中的平均采购价格，并与明细一起显示（每件物品名称，价格）</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">item</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">price</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">AVG</span><span class="p">(</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">purchase</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p><strong>查询结果</strong></p>
<p><img alt="image-20211120185237870" src="img/image-20211120185237870.png" /></p>
<h3 id="5-over">5. 将OVER()的结果用于进一步计算<a class="headerlink" href="#5-over" title="Permanent link">&para;</a></h3>
<ul>
<li>通常，<code>OVER()</code>用于将当前行与一个聚合值进行比较，例如，我们可以计算出员工的薪水和平均薪水之间的差。</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">first_name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">last_name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">salary</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">(),</span><span class="w"></span>
<span class="w">  </span><span class="n">salary</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">difference</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p><img alt="image-20211120185512794" src="img/image-20211120185512794.png" /></p>
<ul>
<li>上面查询结果的最后一列显示了每名员工的工资和平均工资之间的差额，这就是**窗口函数的典型应用场景：将当前行与一组数据的聚合值进行比较**</li>
</ul>
<p><strong>练习3</strong></p>
<ul>
<li>需求：创建报表统计每个员工的工龄和平均工龄之间的差值</li>
<li>报表中包含如下字段：</li>
<li>员工的名字，员工的姓氏，员工的工龄，所有员工的平均工龄，员工工龄和平均工龄之间的差值</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">first_name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">last_name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">years_worked</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">AVG</span><span class="p">(</span><span class="n">years_worked</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">avg</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">years_worked</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">years_worked</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">difference</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p><strong>查询结果：</strong></p>
<p><img alt="image-20211120185432992" src="img/image-20211120185432992.png" /></p>
<p><strong>练习4</strong></p>
<ul>
<li>我们看下面的例子：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">item</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">price</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">price</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">purchase</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">department_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p><strong>查询结果</strong></p>
<p><img alt="image-20211120185552478" src="img/image-20211120185552478.png" /></p>
<ul>
<li>
<p>在上面的SQL中，我们查询了id为2的部门所采购的所有商品，并将计算了每项支出占总采购金额的占比</p>
</li>
<li>
<p>需求：统计人力资源部（部门ID为3） 的员工薪资，并将每名员工的薪资与部门平均薪资进行比较</p>
</li>
<li><code>first_name</code>，<code>last_name</code>，<code>salary</code> 和 <code>difference</code>（员工薪资与部门平均薪资的差值）</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span>
<span class="w">  </span><span class="n">first_name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">last_name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">salary</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">salary</span><span class="o">-</span><span class="k">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">difference</span><span class="w"></span>
<span class="w">  </span><span class="k">from</span><span class="w"> </span><span class="n">employee</span><span class="w"></span>
<span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">department_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
</code></pre></div>
<p><strong>查询结果</strong></p>
<p><img alt="image-20211120185620476" src="img/image-20211120185620476.png" /></p>
<h3 id="6overcount">6.OVER()和COUNT()组合<a class="headerlink" href="#6overcount" title="Permanent link">&para;</a></h3>
<ul>
<li>接下来我们看一下， <code>OVER()</code> 与 <code>COUNT()</code> 如何组合使用</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span>
<span class="w">  </span><span class="n">id</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="n">name</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">department</span><span class="w"></span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p><img alt="image-20211120185653806" src="img/image-20211120185653806.png" /></p>
<ul>
<li>在上面的SQL中，我们查询出每个部门的 <code>id</code> 和 <code>name</code> 部门名称，以及所有部门的数量，最后通过部门名字排序</li>
</ul>
<p><strong>练习5</strong></p>
<ul>
<li>需求：查询月薪超过4000的员工，并统计所有月薪超过4000的员工数量</li>
<li>查询结果字段：<code>first_name</code>, <code>last_name</code>, <code>salary</code> 和 超过4000的员工数量</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">first_name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">last_name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">salary</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">4000</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p><strong>查询结果：</strong></p>
<p><img alt="image-20211120185726198" src="img/image-20211120185726198.png" /></p>
<h3 id="7">7.小结<a class="headerlink" href="#7" title="Permanent link">&para;</a></h3>
<ul>
<li>可以使用<window_function> OVER()，对全部查询结果进行聚合计算</li>
<li>在WHERE条件执行之后，才会执行窗口函数</li>
<li>窗口函数在执行聚合计算的同时还可以保留每行的其它原始信息</li>
<li>不能在WHERE子句中使用窗口函数</li>
</ul>
<h2 id="_2">二、排序函数和窗口配合使用<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>到目前为止，我们已经介绍了如何在窗口函数中使用聚合计算函数<code>SUM()</code>, <code>COUNT()</code>, <code>AVG()</code>, <code>MAX()</code> 和 <code>MIN()</code></p>
<p>接下来，我们将学习如何通过窗口函数实现排序，具体语法如下：</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="n">ranking</span><span class="w"> </span><span class="k">function</span><span class="o">&gt;</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">&lt;</span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">columns</span><span class="o">&gt;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>在后面的练习中我们会介绍常用的排序函数</p>
<h3 id="1_1">1. 数据集准备与介绍<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h3>
<h4 id="11_1">1.1 数据集准备<a class="headerlink" href="#11_1" title="Permanent link">&para;</a></h4>
<p>创建game表</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">game</span><span class="w">  </span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">platform</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">genre</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">editor_rating</span><span class="w"> </span><span class="nb">smallint</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">size</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">released</span><span class="w"> </span><span class="nb">date</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">updated</span><span class="w"> </span><span class="nb">date</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">BTREE</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>插入game表数据</p>
<div class="highlight"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Go Bunny&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;iOS&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;action&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">101</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-05-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-07-13&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Fire Rescue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;iOS&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;action&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">36</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-07-30&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-09-27&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Eternal Stone&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;iOS&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;adventure&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">125</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-03-20&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-10-25&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Froggy Adventure&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;iOS&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;adventure&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">127</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-05-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-07-02&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Speed Race&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;iOS&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;racing&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">127</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-03-20&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-07-25&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Monsters in Dungeon&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Android&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;adventure&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-12-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-12-15&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Shoot in Time&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Android&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;shooting&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-12-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-03-20&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Hit Brick&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Android&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;action&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">54</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-05-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-01-05&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;The Square&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Android&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;action&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">86</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-12-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-03-16&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Duck Dash&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Android&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;shooting&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">36</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-07-30&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-05-23&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Perfect Time&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Windows Phone&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;action&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-12-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-01-07&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;First Finish&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Windows Phone&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;racing&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2015-10-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-02-20&#39;</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>创建game_purchase表</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">game_purchase</span><span class="w">  </span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">game_id</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">price</span><span class="w"> </span><span class="nb">decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nb">date</span><span class="w"> </span><span class="nb">date</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">BTREE</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>插入game_purchase表数据</p>
<div class="highlight"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-03-07&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-08-13&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-01-21&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-21&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-05-03&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-07-08&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-03-29&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-01-05&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-07-18&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-06-04&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-16&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-08-23&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-09-20&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-07-17&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-06-07&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-06-09&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-04-13&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-01-12&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-06-18&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-08-07&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-04-06&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-07-24&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-08-05&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">24</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-07-21&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-05&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">26</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-02-27&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-05-26&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-01-30&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-01-21&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-06-28&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-07-09&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-14&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-07-04&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">34</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-01-27&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-04-06&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">36</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-03-27&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">37</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-07-19&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">38</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-06-20&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">39</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-01-02&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-08-17&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">41</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-06-02&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-04-20&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-06-05&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-04-08&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-06-03&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">46</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-10&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">47</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-04&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">48</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-09-29&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">49</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-03-25&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-02-01&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">51</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-08-29&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">52</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-03-13&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-04-29&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">54</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-05-09&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-06-07&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-09-24&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">57</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-10-30&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">58</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-05-11&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">59</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-08-22&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">game_purchase</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-03-24&#39;</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p><strong>game表</strong></p>
<p><img alt="image-20211120191843948" src="img/image-20211120191843948.png" /></p>
<p><strong>game_purchase表</strong></p>
<p><img alt="image-20220522001230496" src="img/image-20220522001230496.png" /></p>
<h4 id="12_1">1.2 所有表字段信息及逻辑关联关系<a class="headerlink" href="#12_1" title="Permanent link">&para;</a></h4>
<ul>
<li>game游戏信息表</li>
<li>id 游戏的id</li>
<li>name 游戏名字</li>
<li>platform 游戏平台，安卓IOS等</li>
<li>genre 游戏题材种类</li>
<li>editor_rating 评分</li>
<li>size 游戏应用程序的大小</li>
<li>released 游戏发布时间</li>
<li>
<p>updated 最后更新时间</p>
</li>
<li>
<p>game_purchase游戏销售表</p>
</li>
<li>id 当次销售的编号</li>
<li>game_id 游戏的id</li>
<li>price 销售金额</li>
<li>date 销售日期</li>
</ul>
<p><img alt="窗口函数关系表3" src="img/%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E5%85%B3%E7%B3%BB%E8%A1%A83.png" /></p>
<h3 id="2-rank">2. RANK()函数<a class="headerlink" href="#2-rank" title="Permanent link">&para;</a></h3>
<blockquote>
<p>根据某列进行排序，排序后返回排序序号；如果列值相同，排序的序号也是相同的，但序号不是连续的</p>
</blockquote>
<h4 id="21_1">2.1 示例<a class="headerlink" href="#21_1" title="Permanent link">&para;</a></h4>
<p>作用及用法</p>
<ul>
<li><code>RANK()</code>会返回每一行的等级（序号）</li>
<li><code>ORDER BY</code>对行进行排序将数据按升序或降序排列（DESC），<code>RANK（）OVER（ORDER BY ...）</code>是一个函数，与<code>ORDER BY</code> 配合返回序号</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">RANK</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">列</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"></span>
<span class="c1">-- 根据列的值进行排序，返回排序的序号，DESC表示对ORDER BY的列排序采用倒序</span><span class="w"></span>
</code></pre></div>
<ul>
<li>具体看如下例子：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">platform</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">editor_rating</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">editor_rating</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rank_</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">game</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<ul>
<li>上面的SQL对所有数据按编辑评分排序，RANK()函数会返回排序后的排名序号</li>
</ul>
<p><img alt="image-20211120192312940" src="img/image-20211120192312940.png" /></p>
<ul>
<li>观察上面的查询结果：</li>
<li>最后一列 rank_ 中显示了游戏的得分排名，得分最低（4分）的三个游戏并列倒数第一</li>
<li>得分为5分的游戏，排名为4，这里并没有2和3 ，这个就是<code>rank()</code>函数的特点，当有并列的情况出现时，序号是不连续的</li>
</ul>
<h4 id="22">2.2 练习<a class="headerlink" href="#22" title="Permanent link">&para;</a></h4>
<p>需求：统计每个游戏的名字，分类，更新日期，更新日期的顺序</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">genre</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">updated</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">updated</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">date_rank</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">game</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p><strong>查询结果</strong></p>
<p><img alt="image-20211120192344976" src="img/image-20211120192344976.png" /></p>
<h3 id="3-dense_rank">3. DENSE_RANK()函数<a class="headerlink" href="#3-dense_rank" title="Permanent link">&para;</a></h3>
<blockquote>
<p>根据某列进行排序，排序后返回排序序号；如果列值相同，排序的序号也是相同的，和RANK函数的区别在于，序号是连续的</p>
</blockquote>
<h4 id="31">3.1 示例<a class="headerlink" href="#31" title="Permanent link">&para;</a></h4>
<p>RANK() 函数返回的序号，可能会出现不连续的情况；如果想在有并列情况发生的时候仍然返回连续序号可以使用dense_rank()函数。将《2.1示例》中的代码做一个修改</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">platform</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">editor_rating</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">DENSE_RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">editor_rating</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">dense_rank_</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">game</span><span class="p">;</span><span class="w"></span>
<span class="c1">-- 这里注意：在部分mysql版本中起的别名会出现语法冲突造成的异常错误，加一个下划线即可解决</span>
</code></pre></div>
<p><strong>查询结果</strong> 从结果中看出，dense_rank列的序号是连续的，1，2，3，4，5 （跟使用rank 有明显的区别，rank 会跳过2，3）</p>
<p><img alt="image-20211128160655951" src="img/image-20211128160655951.png" /></p>
<h4 id="32">3.2 练习<a class="headerlink" href="#32" title="Permanent link">&para;</a></h4>
<p>需求：对游戏的安装包大小进行排序，使用<code>DENSE_RANK()</code>，返回游戏名称，包大小以及序号</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">size</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">DENSE_RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">size</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dense_rank_</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">game</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p><strong>查询结果</strong></p>
<p><img alt="image-20211120192508072" src="img/image-20211120192508072.png" /></p>
<h3 id="4-row_number">4. ROW_NUMBER()函数<a class="headerlink" href="#4-row_number" title="Permanent link">&para;</a></h3>
<ul>
<li>想获取排序之后的序号，也可以通过ROW_NUMBER() 来实现，从名字上就能知道，意思是返回行号</li>
<li>ROW_NUMBER()函数 根据某列进行排序，排序后返回排序序号；如果列值相同，排序的序号是不同的！</li>
</ul>
<h4 id="41">4.1 示例<a class="headerlink" href="#41" title="Permanent link">&para;</a></h4>
<p>需求：对游戏的安装包大小进行排序，使用<code>ROW_NUMBER()</code>，返回游戏名称，包大小以及序号</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">size</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">size</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">row_number</span><span class="o">`</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">game</span><span class="p">;</span><span class="w"></span>
<span class="c1">-- 对于别名冲突，也可以使用``</span>
</code></pre></div>
<p><strong>查询结果</strong> 从结果可以看出，<code>ROW_NUMBER()</code>返回的是唯一行号（唯一序号），跟<code>RANK()</code> 和 <code>DENSE_RANK()</code> 返回的是序号，序号会有并列情况出现</p>
<p><img alt="image-20211120192532599" src="img/image-20211120192532599.png" /></p>
<h4 id="42-1">4.2 练习1<a class="headerlink" href="#42-1" title="Permanent link">&para;</a></h4>
<p>需求，将游戏按发行时间排序，返回唯一序号</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">released</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">released</span><span class="p">)</span><span class="w"> </span><span class="o">`</span><span class="n">row_number</span><span class="o">`</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">game</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p><strong>查询结果</strong></p>
<p><img alt="image-20211120192558097" src="img/image-20211120192558097.png" /></p>
<h4 id="43-2">4.3 练习2<a class="headerlink" href="#43-2" title="Permanent link">&para;</a></h4>
<p>对比 <code>RANK()</code>, <code>DENSE_RANK()</code>, <code>ROW_NUMBER()</code> 之间的区别，对上面的案例同时使用三个函数</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">  </span><span class="n">name</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">genre</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">released</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">released</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rank_num</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">DENSE_RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">released</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">dense_rank_num</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">released</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">row_num</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">game</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p><strong>查询结果</strong></p>
<p><img alt="image-20211120192628583" src="img/image-20211120192628583.png" /></p>
<h3 id="5">5.小结<a class="headerlink" href="#5" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>最基本的排序函数: <code>RANK() OVER(ORDER BY column1, column2...)</code>.</p>
</li>
<li>
<p>通过排序获取序号的函数介绍了如下三个：</p>
</li>
<li>
<p><code>RANK()</code> – 返回排序后的序号 <strong>rank</strong> ，有并列的情况出现时序号不连续</p>
</li>
<li><code>DENSE_RANK()</code> – 返回  <strong>'连续'</strong> 序号</li>
<li><code>ROW_NUMBER()</code> – 返回连续唯一的行号，与排序<code>ORDER BY</code> 配合返回的是连续不重复的序号</li>
</ul>
<h2 id="_3">三、三范式<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="1_2">1、什么是三范式<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h3>
<p>设计关系数据库时，遵从不同的规范要求，设计出合理的关系型数据库，这些不同的规范要求被称为不同的范式，各种范式呈递次规范，越高的范式数据库冗余越小。</p>
<h3 id="2_1">2、数据冗余<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h3>
<p>数据冗余是指数据之间的重复，也可以说是同一数据存储在不同数据文件中的现象</p>
<p><img alt="image-20220111094748806" src="img/image-20220111094748806.png" /></p>
<p><img alt="image-20220111094815762" src="img/image-20220111094815762.png" /></p>
<h3 id="3_1">3、范式的划分<a class="headerlink" href="#3_1" title="Permanent link">&para;</a></h3>
<p>根据数据库冗余的大小,目前关系型数据库有六种范式,各种范式呈递次规范，越高的范式数据库冗余越小。</p>
<p>六种范式：</p>
<ul>
<li>
<p>第一范式（1NF）</p>
</li>
<li>
<p>第二范式（2NF）</p>
</li>
<li>
<p>第三范式（3NF）</p>
</li>
<li>
<p>巴斯-科德范式（BCNF）</p>
</li>
<li>
<p>第四范式 ( 4NF）</p>
</li>
<li>
<p>第五范式（5NF，又称完美范式）</p>
</li>
</ul>
<p>一般遵循 前三种范式即可</p>
<h3 id="4">4、一范式<a class="headerlink" href="#4" title="Permanent link">&para;</a></h3>
<p>第一范式（1NF）: 强调的是字段的原子性，即一个字段不能够再分成其他几个字段。</p>
<p><img alt="image-20220111095035643" src="img/image-20220111095035643.png" /></p>
<p>这种表结构设计就没有达到 1NF，要符合 1NF 我们只需把字段拆分，即：把 contact 字段拆分成 name 、tel、addr 等字段。</p>
<p><img alt="image-20220111095043738" src="img/image-20220111095043738.png" /></p>
<h3 id="5_1">5、二范式<a class="headerlink" href="#5_1" title="Permanent link">&para;</a></h3>
<p>第二范式（2NF）: 满足 1NF的基础上，另外包含两部分内容</p>
<ul>
<li>
<p>一是表必须有一个主键</p>
</li>
<li>
<p>二是非主键字段必须完全依赖于主键，而不能只依赖于主键的一部分</p>
</li>
</ul>
<p><img alt="image-20220111095145466" src="img/image-20220111095145466.png" /></p>
<p>OrderDetail表的主键是什么？</p>
<p>主键的定义：能够确定唯一一行记录的特殊字段</p>
<p><img alt="image-20220111095205270" src="img/image-20220111095205270.png" /></p>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">创建复合主键</span><span class="w"></span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">id</span><span class="p">)</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
</code></pre></div>
<p><img alt="image-20220111095248873" src="img/image-20220111095248873.png" /></p>
<p>这里有主键由OrderID和ProductID共同组成</p>
<p>同时 UnitPrice 和 ProductName 这里两个字段 与ProductID的从属关系强于他们同OrderID的从属关系 </p>
<p><img alt="image-20220111095302986" src="img/image-20220111095302986.png" /></p>
<h3 id="6">6、三范式<a class="headerlink" href="#6" title="Permanent link">&para;</a></h3>
<p>第三范式（3NF）: 满足 2NF</p>
<p>另外非主键字段必须直接依赖于主键，不能存在传递依赖。</p>
<p>即不能存在：非主键字段 A 依赖于非主键字段 B，非主键字段 B 依赖于主键的情况。</p>
<p><img alt="image-20220111095424576" src="img/image-20220111095424576.png" /></p>
<p>因为 OrderDate，CustomerID，CustomerName，CustomerAddr，CustomerCity 等非主键字段都完全依赖于主键（OrderID），所以符合 2NF。</p>
<p>不过问题是 CustomerName，CustomerAddr，CustomerCity 直接依赖的是 CustomerID（非主键列），而不是直接依赖于主键，它是通过传递才依赖于主键，所以不符合 3NF。</p>
<p><img alt="image-20220111095444389" src="img/image-20220111095444389.png" /></p>
<p>把【Order】表拆分为【Order】（OrderID，OrderDate，CustomerID）和【Customer】（CustomerID，CustomerName，CustomerAddr，CustomerCity）从而达到 3NF。</p>
<h3 id="7_1">7、小结<a class="headerlink" href="#7_1" title="Permanent link">&para;</a></h3>
<p>范式:</p>
<p>设计关[数据库时，遵从不同的规范要求，设计出合理的关系型数据库，这些不同的规范要求被称为不同的范式，</p>
<p>各种范式呈递次规范，越高的范式数据库冗余越小。</p>
<p>三范式:</p>
<p>第一范式（1NF）: 强调的是列的原子性，即列不能够再分成其他几列。</p>
<p>第二范式（2NF）: 满足 1NF，另外包含两部分内容，一是表必须有一个主键；二是非主键字段 必须完全依赖于主键，而不能只依赖于主键的一部分。</p>
<p>第三范式（3NF）: 满足 2NF，另外非主键列必须直接依赖于主键，不能存在传递依赖。</p>
<p>即不能存在：非主键列 A 依赖于非主键列 B，非主键列 B 依赖于主键的情况。</p>
<h2 id="e-r">四、E-R模型及表间关系<a class="headerlink" href="#e-r" title="Permanent link">&para;</a></h2>
<h3 id="1e-r">1、E-R模型的使用场景<a class="headerlink" href="#1e-r" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>对于大型公司开发项目，我们需要根据产品经理的设计，先使用建模工具, 如：power designer，db desinger等这些软件来画出实体-关系模型(E-R模型)</p>
</li>
<li>
<p>然后根据三范式设计数据库表结构</p>
</li>
</ol>
<h3 id="2e-r">2、E-R模型<a class="headerlink" href="#2e-r" title="Permanent link">&para;</a></h3>
<p>E-R模型即实体-关系模型</p>
<p>E-R模型就是描述数据库存储数据的结构模型</p>
<p><img alt="image-20220111095817454" src="img/image-20220111095817454.png" /></p>
<h3 id="3_2">3、三种关系<a class="headerlink" href="#3_2" title="Permanent link">&para;</a></h3>
<p>表现形式</p>
<ul>
<li>
<p>实体: 用矩形表示，并标注实体名称</p>
</li>
<li>
<p>属性: 用椭圆表示，并标注属性名称</p>
</li>
<li>
<p>关系: 用菱形表示，并标注关系名称</p>
</li>
</ul>
<p>E-R模型中的三种关系</p>
<ul>
<li>一对一</li>
</ul>
<p><img alt="image-20220111095929110" src="img/image-20220111095929110.png" /></p>
<ul>
<li>一对多(1-n)</li>
</ul>
<p><img alt="image-20220111095943842" src="img/image-20220111095943842.png" /></p>
<ul>
<li>多对多(m-n)</li>
</ul>
<p><img alt="image-20220111095957194" src="img/image-20220111095957194.png" /></p>
<h3 id="4_1">4、小结<a class="headerlink" href="#4_1" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>E-R模型由 实体、属性、实体之间的关系构成，主要用来描述数据库中表之间的关系和表结构。</p>
</li>
<li>
<p>开发流程是先画出E-R模型，然后根据三范式设计数据库中的表结构</p>
</li>
</ol>
<h2 id="pymysql">五、PyMySQL<a class="headerlink" href="#pymysql" title="Permanent link">&para;</a></h2>
<h3 id="1_3">1、数据准备<a class="headerlink" href="#1_3" title="Permanent link">&para;</a></h3>
<h4 id="1_4">1 创建数据表<a class="headerlink" href="#1_4" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">-- 创建 &quot;jd&quot; 数据库</span>
<span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="n">jd</span><span class="w"> </span><span class="n">charset</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span><span class="w"></span>

<span class="c1">-- 使用 &quot;jd&quot; 数据库</span>
<span class="n">use</span><span class="w"> </span><span class="n">jd</span><span class="p">;</span><span class="w"></span>

<span class="c1">-- 创建一个商品goods数据表</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">goods</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">auto_increment</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">cate_name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">brand_name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">price</span><span class="w"> </span><span class="nb">decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">is_show</span><span class="w"> </span><span class="nb">bit</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">is_saleoff</span><span class="w"> </span><span class="nb">bit</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</code></pre></div>
<h4 id="2_2">2 插入数据<a class="headerlink" href="#2_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">-- 向goods表中插入数据</span>

<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;r510vc 15.6英寸笔记本&#39;</span><span class="p">,</span><span class="s1">&#39;笔记本&#39;</span><span class="p">,</span><span class="s1">&#39;华硕&#39;</span><span class="p">,</span><span class="s1">&#39;3399&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;y400n 14.0英寸笔记本电脑&#39;</span><span class="p">,</span><span class="s1">&#39;笔记本&#39;</span><span class="p">,</span><span class="s1">&#39;联想&#39;</span><span class="p">,</span><span class="s1">&#39;4999&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"></span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;g150th 15.6英寸游戏本&#39;</span><span class="p">,</span><span class="s1">&#39;游戏本&#39;</span><span class="p">,</span><span class="s1">&#39;雷神&#39;</span><span class="p">,</span><span class="s1">&#39;8499&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;x550cc 15.6英寸笔记本&#39;</span><span class="p">,</span><span class="s1">&#39;笔记本&#39;</span><span class="p">,</span><span class="s1">&#39;华硕&#39;</span><span class="p">,</span><span class="s1">&#39;2799&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;x240 超极本&#39;</span><span class="p">,</span><span class="s1">&#39;超级本&#39;</span><span class="p">,</span><span class="s1">&#39;联想&#39;</span><span class="p">,</span><span class="s1">&#39;4880&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;u330p 13.3英寸超极本&#39;</span><span class="p">,</span><span class="s1">&#39;超级本&#39;</span><span class="p">,</span><span class="s1">&#39;联想&#39;</span><span class="p">,</span><span class="s1">&#39;4299&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;svp13226scb 触控超极本&#39;</span><span class="p">,</span><span class="s1">&#39;超级本&#39;</span><span class="p">,</span><span class="s1">&#39;索尼&#39;</span><span class="p">,</span><span class="s1">&#39;7999&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ipad mini 7.9英寸平板电脑&#39;</span><span class="p">,</span><span class="s1">&#39;平板电脑&#39;</span><span class="p">,</span><span class="s1">&#39;苹果&#39;</span><span class="p">,</span><span class="s1">&#39;1998&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"></span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ipad air 9.7英寸平板电脑&#39;</span><span class="p">,</span><span class="s1">&#39;平板电脑&#39;</span><span class="p">,</span><span class="s1">&#39;苹果&#39;</span><span class="p">,</span><span class="s1">&#39;3388&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ipad mini 配备 retina 显示屏&#39;</span><span class="p">,</span><span class="s1">&#39;平板电脑&#39;</span><span class="p">,</span><span class="s1">&#39;苹果&#39;</span><span class="p">,</span><span class="s1">&#39;2788&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ideacentre c340 20英寸一体电脑 &#39;</span><span class="p">,</span><span class="s1">&#39;台式机&#39;</span><span class="p">,</span><span class="s1">&#39;联想&#39;</span><span class="p">,</span><span class="s1">&#39;3499&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;vostro 3800-r1206 台式电脑&#39;</span><span class="p">,</span><span class="s1">&#39;台式机&#39;</span><span class="p">,</span><span class="s1">&#39;戴尔&#39;</span><span class="p">,</span><span class="s1">&#39;2899&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;imac me086ch/a 21.5英寸一体电脑&#39;</span><span class="p">,</span><span class="s1">&#39;台式机&#39;</span><span class="p">,</span><span class="s1">&#39;苹果&#39;</span><span class="p">,</span><span class="s1">&#39;9188&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;at7-7414lp 台式电脑 linux ）&#39;</span><span class="p">,</span><span class="s1">&#39;台式机&#39;</span><span class="p">,</span><span class="s1">&#39;宏碁&#39;</span><span class="p">,</span><span class="s1">&#39;3699&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;z220sff f4f06pa工作站&#39;</span><span class="p">,</span><span class="s1">&#39;服务器/工作站&#39;</span><span class="p">,</span><span class="s1">&#39;惠普&#39;</span><span class="p">,</span><span class="s1">&#39;4288&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;poweredge ii服务器&#39;</span><span class="p">,</span><span class="s1">&#39;服务器/工作站&#39;</span><span class="p">,</span><span class="s1">&#39;戴尔&#39;</span><span class="p">,</span><span class="s1">&#39;5388&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;mac pro专业级台式电脑&#39;</span><span class="p">,</span><span class="s1">&#39;服务器/工作站&#39;</span><span class="p">,</span><span class="s1">&#39;苹果&#39;</span><span class="p">,</span><span class="s1">&#39;28888&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;hmz-t3w 头戴显示设备&#39;</span><span class="p">,</span><span class="s1">&#39;笔记本配件&#39;</span><span class="p">,</span><span class="s1">&#39;索尼&#39;</span><span class="p">,</span><span class="s1">&#39;6999&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;商务双肩背包&#39;</span><span class="p">,</span><span class="s1">&#39;笔记本配件&#39;</span><span class="p">,</span><span class="s1">&#39;索尼&#39;</span><span class="p">,</span><span class="s1">&#39;99&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;x3250 m4机架式服务器&#39;</span><span class="p">,</span><span class="s1">&#39;服务器/工作站&#39;</span><span class="p">,</span><span class="s1">&#39;ibm&#39;</span><span class="p">,</span><span class="s1">&#39;6888&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"> </span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;商务双肩背包&#39;</span><span class="p">,</span><span class="s1">&#39;笔记本配件&#39;</span><span class="p">,</span><span class="s1">&#39;索尼&#39;</span><span class="p">,</span><span class="s1">&#39;99&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<h4 id="3_3">3 分表<a class="headerlink" href="#3_3" title="Permanent link">&para;</a></h4>
<h5 id="31_1">3.1 创建商品分类表<a class="headerlink" href="#31_1" title="Permanent link">&para;</a></h5>
<p>由于只存在一张表 其中既有商品信息又有分类名称和品牌名称。当把某种分类或者品牌的商品全部删除后，本不应该删除&lt;独立于商品信息的分类和品牌&gt;等信息结果也随着删除商品信息而删除，那么此时存在**删除异常**。</p>
<p>为解决删除异常问题，则必须再创建分类表和品牌表单独用来存储数据。</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- 创建商品分类表</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="n">goods_cates</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">auto_increment</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>将分组结果写入到goods_cates商品种类数据表</p>
<div class="highlight"><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">goods_cates</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="n">cate_name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">cate_name</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>将商品表中的分类名称更改为分类名称对应的分类id，通过goods_cates数据表来更新goods表</p>
<div class="highlight"><pre><span></span><code><span class="k">update</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">g</span><span class="w"></span>
<span class="w">    </span><span class="k">join</span><span class="w"> </span><span class="n">goods_cates</span><span class="w"> </span><span class="n">gc</span><span class="w"></span>
<span class="w">    </span><span class="k">on</span><span class="w"> </span><span class="k">g</span><span class="p">.</span><span class="n">cate_name</span><span class="o">=</span><span class="n">gc</span><span class="p">.</span><span class="n">name</span><span class="w"> </span>
<span class="w">    </span><span class="k">set</span><span class="w"> </span><span class="k">g</span><span class="p">.</span><span class="n">cate_name</span><span class="o">=</span><span class="n">gc</span><span class="p">.</span><span class="n">id</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<h5 id="32_1">3.2 创建商品品牌表<a class="headerlink" href="#32_1" title="Permanent link">&para;</a></h5>
<ul>
<li>创建 "商品品牌表" 表并导入品牌名称，通过create table ...select来创建数据表并且同时写入记录,一步到位</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">-- select brand_name from goods group by brand_name;</span>

<span class="c1">-- 在创建数据表的时候一起插入数据</span>
<span class="c1">-- 注意: 需要对brand_name 用as起别名，否则name字段就没有值</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">goods_brands</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">auto_increment</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">brand_name</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>使用商品品牌表中的信息更新商品表信息，通过goods_brands数据表来更新goods数据表</p>
<div class="highlight"><pre><span></span><code><span class="k">update</span><span class="w"> </span><span class="n">goods</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">g</span><span class="w"> </span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">goods_brands</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">g</span><span class="p">.</span><span class="n">brand_name</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="k">g</span><span class="p">.</span><span class="n">brand_name</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">id</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<h5 id="33">3.3 修改商品表表结构<a class="headerlink" href="#33" title="Permanent link">&para;</a></h5>
<p>查看 goods 的数据表结构,会发现 cate_name 和 brand_name对应的类型为 <code>varchar</code> </p>
<div class="highlight"><pre><span></span><code><span class="k">desc</span><span class="w"> </span><span class="n">goods</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>通过alter table语句修改表结构</p>
<div class="highlight"><pre><span></span><code><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">goods</span><span class="w">  </span>
<span class="n">change</span><span class="w"> </span><span class="n">cate_name</span><span class="w"> </span><span class="n">cate_id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"></span>
<span class="n">change</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<h3 id="2pymysql">2、为什么要学习PyMySQL<a class="headerlink" href="#2pymysql" title="Permanent link">&para;</a></h3>
<p>如何实现将100000条数据插入到MySQL数据库?</p>
<p><strong>答案:</strong></p>
<p>如果使用之前学习的MySQL客户端来完成这个操作，那么这个工作量无疑是巨大的，我们可以通过使用程序代码的方式去连接MySQL数据库，然后对MySQL数据库进行增删改查的方式，实现100000条数据的插入，像这样使用代码的方式操作数据库就称为数据库编程。</p>
<p>安装PyMySQL：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># pip install pymysql</span>
</code></pre></div>
<p>卸载PyMySQL：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># pip uninstall pymysql</span>
</code></pre></div>
<h3 id="3pymysql">3、PyMySQL的使用<a class="headerlink" href="#3pymysql" title="Permanent link">&para;</a></h3>
<p><strong>操作步骤:</strong></p>
<ol>
<li>导入模块</li>
<li>创建连接</li>
<li>创建游标</li>
<li>执行sql</li>
<li>关闭游标</li>
<li>关闭连接</li>
</ol>
<h4 id="1-pymysql">1 导入pymysql包<a class="headerlink" href="#1-pymysql" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code> <span class="kn">import</span> <span class="nn">pymysql</span>
</code></pre></div>
<h4 id="2_3">2 创建连接对象<a class="headerlink" href="#2_3" title="Permanent link">&para;</a></h4>
<p>调用pymysql模块中的connect()函数来创建连接对象,代码如下:</p>
<div class="highlight"><pre><span></span><code> <span class="n">conn</span><span class="o">=</span><span class="n">connect</span><span class="p">(</span><span class="n">参数列表</span><span class="p">)</span>
 <span class="o">*</span> <span class="n">参数host</span><span class="err">：</span><span class="n">连接的mysql主机</span><span class="err">，</span><span class="n">如果本机是</span><span class="s1">&#39;localhost&#39;</span>
 <span class="o">*</span> <span class="n">参数port</span><span class="err">：</span><span class="n">连接的mysql主机的端口</span><span class="err">，</span><span class="n">默认是3306</span>
 <span class="o">*</span> <span class="n">参数user</span><span class="err">：</span><span class="n">连接的用户名</span>
 <span class="o">*</span> <span class="n">参数password</span><span class="err">：</span><span class="n">连接的密码</span>
 <span class="o">*</span> <span class="n">参数database</span><span class="err">：</span><span class="n">数据库的名称</span>
 <span class="o">*</span> <span class="n">参数charset</span><span class="err">：</span><span class="n">通信采用的编码方式</span><span class="err">，</span><span class="n">推荐使用utf8</span>
</code></pre></div>
<p>连接对象操作说明:</p>
<ul>
<li>关闭连接 conn.close()</li>
<li>提交数据 conn.commit()</li>
<li>撤销数据 conn.rollback()</li>
</ul>
<h4 id="3_4">3 获取游标对象<a class="headerlink" href="#3_4" title="Permanent link">&para;</a></h4>
<p>获取游标对象的目标就是要执行sql语句，完成对数据库的增、删、改、查操作。代码如下:</p>
<div class="highlight"><pre><span></span><code> <span class="c1"># 调用连接对象的cursor()方法获取游标对象   </span>
 <span class="n">cur</span> <span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</code></pre></div>
<p>游标操作说明:</p>
<ul>
<li>使用游标执行SQL语句: execute(operation [parameters ]) 执行SQL语句，返回受影响的行数，主要用于执行insert、update、delete、select等语句</li>
<li>获取查询结果集中的一条数据:cur.fetchone()返回一个元组</li>
<li>获取查询结果集中的所有数据: cur.fetchall()返回一个元组</li>
<li>关闭游标: cur.close(),表示和数据库操作完成</li>
</ul>
<h4 id="4-pymysql">4 pymysql完成数据的查询操作<a class="headerlink" href="#4-pymysql" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pymysql</span>

<span class="c1"># 创建连接对象</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="s1">&#39;192.168.88.161&#39;</span><span class="p">,</span>  <span class="c1"># 指定要连接的数据库的地址，本机就写成 localhost，或者是 127.0.0.1</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span>   <span class="c1"># 指定连接的数据库的端口号</span>
    <span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>  <span class="c1"># 设置要连接的mysql数据库的用户名</span>
    <span class="n">password</span><span class="o">=</span><span class="s1">&#39;1232456&#39;</span><span class="p">,</span>  <span class="c1"># 设置要连接的mysql数据库的密码</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;jd&quot;</span><span class="p">,</span> <span class="c1"># 设置要连接的数据库的名字</span>
    <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span>  <span class="c1"># 设置我们使用的编码格式，一般就是utf8</span>
<span class="p">)</span>

<span class="c1"># 获取游标对象</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># 查询 SQL 语句</span>
<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;select * from goods;&quot;</span>
<span class="c1"># 执行 SQL 语句 返回值就是 SQL 语句在执行过程中影响的行数</span>
<span class="n">row_count</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SQL 语句执行影响的行数</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">row_count</span><span class="p">)</span>

<span class="c1"># 取出结果集中一行数据</span>
<span class="c1"># print(cursor.fetchone())</span>

<span class="c1"># 取出结果集中的所有数据</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="c1"># 关闭游标</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># 关闭连接</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<h4 id="5-pymysql">5 pymysql完成对数据的增删改<a class="headerlink" href="#5-pymysql" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pymysql</span>

<span class="c1"># 创建连接对象</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="s1">&#39;192.168.88.161&#39;</span><span class="p">,</span>  <span class="c1"># 指定要连接的数据库的地址，本机就写成 localhost，或者是 127.0.0.1</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span>   <span class="c1"># 指定连接的数据库的端口号</span>
    <span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>  <span class="c1"># 设置要连接的mysql数据库的用户名</span>
    <span class="n">password</span><span class="o">=</span><span class="s1">&#39;1232456&#39;</span><span class="p">,</span>  <span class="c1"># 设置要连接的mysql数据库的密码</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;jd&quot;</span><span class="p">,</span> <span class="c1"># 设置要连接的数据库的名字</span>
    <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span>  <span class="c1"># 设置我们使用的编码格式，一般就是utf8</span>
<span class="p">)</span>

<span class="c1"># 获取游标对象</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># 添加 SQL 语句</span>
    <span class="c1"># sql = &quot;insert into goods(name) values(), ();&quot;</span>
    <span class="c1"># 删除 SQ L语句</span>
    <span class="c1"># sql = &quot;delete from goods where id = 5;&quot;</span>
    <span class="c1"># 修改 SQL 语句</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;update goods set name = &#39;拯救者&#39; where id = 6;&quot;</span>
    <span class="c1"># 执行 SQL 语句</span>
    <span class="n">row_count</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SQL 语句执行影响的行数</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">row_count</span><span class="p">)</span>
    <span class="c1"># 提交数据到数据库</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># 回滚数据， 即撤销刚刚的SQL语句操作</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

<span class="c1"># 关闭游标</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># 关闭连接</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<p>注：PyMySQL是基于事务进行操作的，所以在数据库增删改操作时，必须通过conn.commit() 方法将事务操作提交到数据库，如果事务操作没有成功，则可以通过conn.rollback()进行回滚（返回到数据的原始状态）。</p>
<h3 id="4sql">4、SQL注入<a class="headerlink" href="#4sql" title="Permanent link">&para;</a></h3>
<h4 id="1-sql">1. 什么是SQL注入<a class="headerlink" href="#1-sql" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>SQL注入:</strong></li>
</ul>
<p>简单说sql注入是一种可以使得数据库中的数据泄露的方式。如果有一些人有恶意的目的，可以利用sql注入完成盗取数据。</p>
<p><img alt="sql注入" src="img/sql%E6%B3%A8%E5%85%A5.jpg" /></p>
<ul>
<li><strong>产生原因:</strong></li>
</ul>
<p>后台将用户提交的带有恶意的数据和SQL进行字符串方式的拼接，从而影响了SQL语句的语义，最终产生数据泄露的现象. </p>
<blockquote>
<p>简单的说, 就是利用各种方式提交数据给程序并让这些数据和SQL语句产生结合, 进而让新产生的SQL语句和之前的原始的SQL语句变成不同的意思, 至此就可以利用新产生的SQL语句获取想要的数据了.</p>
</blockquote>
<ul>
<li><strong>防止SQL注入</strong></li>
</ul>
<p>SQL语句的参数化可以防止SQL注入的产生. 将SQL语句的所有数据参数存在一个列表中传递给execute函数的第二个参数进行执行, 就是SQL语句参数化.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 把sql语句需要的参数放到一个列表中</span>
<span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">xxx</span><span class="p">,</span><span class="n">xxx</span><span class="p">,</span><span class="n">xxx</span><span class="p">]</span>
<span class="c1"># 把列表作为execute方法的第二个参数传递</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span><span class="n">my_list</span><span class="p">)</span>
</code></pre></div>
<h4 id="2-sql">2. 非安全方式的SQL语句<a class="headerlink" href="#2-sql" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. 导包</span>
<span class="kn">import</span> <span class="nn">pymysql</span>

<span class="c1"># 2. 创建连接对象</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="s1">&#39;192.168.88.161&#39;</span><span class="p">,</span>  <span class="c1"># 指定要连接的数据库的地址，本机就写成 localhost，或者是 127.0.0.1</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span>   <span class="c1"># 指定连接的数据库的端口号</span>
    <span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>  <span class="c1"># 设置要连接的mysql数据库的用户名</span>
    <span class="n">password</span><span class="o">=</span><span class="s1">&#39;1232456&#39;</span><span class="p">,</span>  <span class="c1"># 设置要连接的mysql数据库的密码</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;jd&quot;</span><span class="p">,</span> <span class="c1"># 设置要连接的数据库的名字</span>
    <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span>  <span class="c1"># 设置我们使用的编码格式，一般就是utf8</span>
<span class="p">)</span>

<span class="c1"># 3. 创建一个 游标对象  Cursor</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># 运行代码，等待用户输入商品类别进行查询</span>
<span class="c1"># 4 用户输入</span>
<span class="n">cate</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;请输入商品类别:&quot;</span><span class="p">)</span>

<span class="c1"># SELECT g.name, gc.name from goods as g JOIN goods_cates gc ON g.cate_id = gc.id where gc.name=&#39;%s&#39;;</span>
<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT g.name, gc.name from goods as g JOIN goods_cates gc ON g.cate_id = gc.id where gc.name=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sql</span><span class="o">%</span><span class="n">cate</span><span class="p">)</span>
<span class="c1"># 5 执行sql语句</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="o">%</span><span class="n">cate</span><span class="p">)</span>

<span class="c1"># 安全方式</span>
<span class="c1">#sql = &quot;SELECT g.name, gc.name from goods as g JOIN goods_cates gc ON g.cate_id = gc.id where gc.name=%s;&quot;</span>
<span class="c1">#print(sql%cate)</span>
<span class="c1"># 5 执行sql语句</span>
<span class="c1">#cursor.execute(sql, [cate])</span>

<span class="c1"># 输出结果</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="c1"># 6</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<p><strong>注意:</strong></p>
<p>在输入商品名称的时候输入</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 输入</span>
<span class="n">笔记本</span><span class="s1">&#39; or 1=1 or &quot;&quot;&#39;</span>  
<span class="n">笔记本</span><span class="s1">&#39; or 1=1 &#39;</span>  
<span class="c1">#SELECT g.name, gc.name from goods as g JOIN goods_cates gc ON g.cate_id = gc.id where gc.name=&#39;笔记本&#39; or 1=1 or &quot;&quot;&#39; &#39;</span>
</code></pre></div>
<p>这样就完成了一个简单的SQL注入</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 原始的sql语句</span>
<span class="n">sql</span> <span class="o">=</span> <span class="s1">&#39;select * from goods where name=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">find_name</span>
<span class="c1"># 输入 &quot; or 1=1 or &quot;  后的sql语句 </span>
<span class="n">sql</span> <span class="o">=</span> <span class="s1">&#39;select * from goods where name=&quot;&quot; or 1=1 or &quot;&quot;&#39;</span> 
</code></pre></div>
<p>这里 **name= "" or 1=1 or "" **这个条件是一定成立的,因为**or**是或的意思多个条件只要有一个条件成立整体就成立,而**1=1**是一定成立的. 这就造成这个sql语句的意思发生里改变.</p>
<h4 id="3-sql">3. 安全方式的SQL语句<a class="headerlink" href="#3-sql" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pymysql</span> <span class="kn">import</span> <span class="n">connect</span>

<span class="c1"># 创建Connection连接</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="s1">&#39;192.168.88.161&#39;</span><span class="p">,</span>  <span class="c1"># 指定要连接的数据库的地址，本机就写成 localhost，或者是 127.0.0.1</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span>   <span class="c1"># 指定连接的数据库的端口号</span>
    <span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>  <span class="c1"># 设置要连接的mysql数据库的用户名</span>
    <span class="n">password</span><span class="o">=</span><span class="s1">&#39;1232456&#39;</span><span class="p">,</span>  <span class="c1"># 设置要连接的mysql数据库的密码</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;jd&quot;</span><span class="p">,</span> <span class="c1"># 设置要连接的数据库的名字</span>
    <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span>  <span class="c1"># 设置我们使用的编码格式，一般就是utf8</span>
<span class="p">)</span>

<span class="c1"># 获得Cursor对象</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># 获取用户想要查询的物品名称</span>
<span class="n">find_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;请输入物品名称：&quot;</span><span class="p">)</span>

<span class="c1"># sql语句</span>
<span class="c1"># 注意: </span>
<span class="c1"># 此处不同于python的字符串格式化，必须全部使用%s占位</span>
<span class="c1"># 所有参数所需占位符外不需要加引号</span>
<span class="n">sql</span> <span class="o">=</span> <span class="s1">&#39;select * from goods where name=</span><span class="si">%s</span><span class="s1">&#39;</span>

<span class="c1"># 安全的方式</span>
<span class="c1"># 构造参数列表 </span>
<span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">find_name</span><span class="p">]</span>
<span class="c1"># 执行select语句</span>
<span class="c1"># 注意:</span>
<span class="c1"># 如果要是有多个参数，需要进行参数化</span>
<span class="c1"># 那么params = [数值1, 数值2....]，此时sql语句中有多个%s即可 </span>
<span class="n">count</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

<span class="c1"># 获取查询的结果</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="c1"># 打印查询的结果</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># 关闭Cursor对象</span>
<span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># 关闭Connection对象</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<p>利用参数化列表就可以完成防止SQL注入。</p>
<h4 id="4_2">4. 小结<a class="headerlink" href="#4_2" title="Permanent link">&para;</a></h4>
<p>SQL注入问题</p>
<ul>
<li>将SQL语句的所有数据参数存在一个列表中传递给execute函数的第二个参数</li>
</ul>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="页脚">
      
        
        <a href="MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%802.html" class="md-footer__link md-footer__link--prev" aria-label="上一页: 2 MySQL数据库基础II" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              2 MySQL数据库基础II
            </div>
          </div>
        </a>
      
      
        
        <a href="../03_%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/01_%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" class="md-footer__link md-footer__link--next" aria-label="下一页: 1 环境搭建及使用" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              1 环境搭建及使用
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.1514a9a0.min.js"></script>
      
        <script src="../js/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>